{
  "active": true,
  "connections": {
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Update Name",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook1": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields Nacionalidade": {
      "main": [
        [
          {
            "node": "Update Nacionalidade",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Nacionalidade": {
      "main": [
        [
          {
            "node": "Edit Fields Nacionalidade",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields Origem": {
      "main": [
        [
          {
            "node": "Update Origem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Origem": {
      "main": [
        [
          {
            "node": "Edit Fields Origem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields Serviço": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Serviço": {
      "main": [
        [
          {
            "node": "Mover Lead",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Serviço": {
      "main": [
        [
          {
            "node": "Edit Fields Serviço",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Motivo Visto": {
      "main": [
        [
          {
            "node": "Update Motivo Visto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Motivo Visto": {
      "main": [
        [
          {
            "node": "Edit Motivo Visto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Tipo Visto": {
      "main": [
        [
          {
            "node": "Update Tipo Visto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Tipo Visto": {
      "main": [
        [
          {
            "node": "Edit Tipo Visto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields Venda Perdida": {
      "main": [
        [
          {
            "node": "Mover Lead para VENDA PERDIDA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Venda Perdida": {
      "main": [
        [
          {
            "node": "Edit Fields Venda Perdida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Lead": {
      "main": [
        [
          {
            "node": "Get Contact",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‘Execute workflow’": {
      "main": [
        [
          {
            "node": "Get Lead",
            "type": "main",
            "index": 0
          },
          {
            "node": "Chat Memory Manager1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory1": {
      "ai_memory": [
        [
          {
            "node": "Chat Memory Manager1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Mover Lead": {
      "main": [
        [
          {
            "node": "Move Lead to LEVANTAMENTO INFOS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Update Serviço",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields urgencia": {
      "main": [
        [
          {
            "node": "Update urgencia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook urgencia": {
      "main": [
        [
          {
            "node": "Edit Fields urgencia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields data_chegada": {
      "main": [
        [
          {
            "node": "Update data_chegada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook data_chegada": {
      "main": [
        [
          {
            "node": "Edit Fields data_chegada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields data_partida": {
      "main": [
        [
          {
            "node": "Update data_partida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook data_partida": {
      "main": [
        [
          {
            "node": "Edit Fields data_partida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields grupo": {
      "main": [
        [
          {
            "node": "Update grupo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook grupo": {
      "main": [
        [
          {
            "node": "Edit Fields grupo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields perfil": {
      "main": [
        [
          {
            "node": "Update perfil",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook perfil": {
      "main": [
        [
          {
            "node": "Edit Fields perfil",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields passeio": {
      "main": [
        [
          {
            "node": "Update passeio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook passeio": {
      "main": [
        [
          {
            "node": "Edit Fields passeio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Perda": {
      "main": [
        [
          {
            "node": "Mover Perda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook pos_vendas": {
      "main": [
        [
          {
            "node": "Mover pos_vendas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook qualificado": {
      "main": [
        [
          {
            "node": "Mover qualificado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Human": {
      "main": [
        [
          {
            "node": "Request Human",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields pessoas": {
      "main": [
        [
          {
            "node": "Update pessoas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook pessoas": {
      "main": [
        [
          {
            "node": "Edit Fields pessoas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields hospedagem": {
      "main": [
        [
          {
            "node": "Update hospedagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook hospedagem": {
      "main": [
        [
          {
            "node": "Edit Fields hospedagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields idade_criacas": {
      "main": [
        [
          {
            "node": "Update idade_criacas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook idade_criacas": {
      "main": [
        [
          {
            "node": "Edit Fields idade_criacas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields empreendimento": {
      "main": [
        [
          {
            "node": "Update empreendimento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook empreendimento": {
      "main": [
        [
          {
            "node": "Edit Fields empreendimento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook material": {
      "main": [
        [
          {
            "node": "Mover material",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook simulacao": {
      "main": [
        [
          {
            "node": "Mover simulacao",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields estado_civil": {
      "main": [
        [
          {
            "node": "Update estado_civil",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook estado_civil": {
      "main": [
        [
          {
            "node": "Edit Fields estado_civil",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields renda": {
      "main": [
        [
          {
            "node": "Update renda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook renda": {
      "main": [
        [
          {
            "node": "Edit Fields renda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields tipo_renda": {
      "main": [
        [
          {
            "node": "Update tipo_renda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook tipo_renda": {
      "main": [
        [
          {
            "node": "Edit Fields tipo_renda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields imposto": {
      "main": [
        [
          {
            "node": "Update imposto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook imposto": {
      "main": [
        [
          {
            "node": "Edit Fields imposto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields nascimento": {
      "main": [
        [
          {
            "node": "Update nascimento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook nascimento": {
      "main": [
        [
          {
            "node": "Edit Fields nascimento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook negociacao": {
      "main": [
        [
          {
            "node": "Mover negociacao",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields Img 1": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Lead1": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Get Lead1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Session": {
      "main": [
        [
          {
            "node": "Split binary Chunks",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get File": {
      "main": [
        []
      ]
    },
    "Get File Size": {
      "main": [
        [
          {
            "node": "Create Session",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split binary Chunks": {
      "main": [
        [
          {
            "node": "Upload File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Download file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file": {
      "main": [
        [
          {
            "node": "Get File Size",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload File": {
      "main": [
        [
          {
            "node": "Get Metadata",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Metadata": {
      "main": [
        [
          {
            "node": "Send Message2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Message2": {
      "main": [
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields Img ": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Lead2": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet1": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Material - Media 1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Get Lead2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Material - Media 1": {
      "main": [
        [
          {
            "node": "Material - Media 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Material - Media 2": {
      "main": [
        [
          {
            "node": "Material - Media 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Material - Media 3": {
      "main": [
        [
          {
            "node": "Material - Media 4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Material - Media 4": {
      "main": [
        [
          {
            "node": "Material - Media 5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Material - Media 5": {
      "main": [
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Metadata1": {
      "main": [
        [
          {
            "node": "Send Message4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields6": {
      "main": [
        [
          {
            "node": "Get Metadata1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Message4": {
      "main": [
        [
          {
            "node": "Material - Link",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Material - PDF": {
      "main": [
        [
          {
            "node": "Edit Fields7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Material - Link": {
      "main": [
        [
          {
            "node": "Material - PDF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields Img 2": {
      "main": [
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Lead3": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet2": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "Simulacao - Media",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait2": {
      "main": [
        [
          {
            "node": "Get Lead3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simulacao - Media": {
      "main": [
        [
          {
            "node": "Simulacao - Media1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simulacao - Media1": {
      "main": [
        [
          {
            "node": "Edit Fields9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields Img 3": {
      "main": [
        [
          {
            "node": "Wait3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait3": {
      "main": [
        [
          {
            "node": "Get Lead4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Lead4": {
      "main": [
        [
          {
            "node": "Select rows from a table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "Set base64",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table": {
      "main": [
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get File Size1": {
      "main": [
        [
          {
            "node": "Create Session1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Session1": {
      "main": [
        [
          {
            "node": "Split binary Chunks1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set base64": {
      "main": [
        [
          {
            "node": "Material - Media 6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split binary Chunks1": {
      "main": [
        [
          {
            "node": "Upload File1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Message5": {
      "main": [
        [
          {
            "node": "Edit Fields11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Metadata2": {
      "main": [
        [
          {
            "node": "Send Message5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload File1": {
      "main": [
        [
          {
            "node": "Get Metadata2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook img 1": {
      "main": [
        [
          {
            "node": "Edit Fields Img 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields Img 4": {
      "main": [
        [
          {
            "node": "Wait4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Lead5": {
      "main": [
        [
          {
            "node": "Get Empreendimento 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If5": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait4": {
      "main": [
        [
          {
            "node": "Get Lead5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Material - Media ": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Metadata3": {
      "main": [
        [
          {
            "node": "Contem Link",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Message6": {
      "main": [
        [
          {
            "node": "Send Link",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields13": {
      "main": [
        [
          {
            "node": "Send Message6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Material - PDF1": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Empreendimento 2": {
      "main": [
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Get Metadata3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Material - Media ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Contem Link": {
      "main": [
        [
          {
            "node": "Edit Fields13",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Send Link": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Contem PDF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Edit Fields14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Contem PDF": {
      "main": [
        [
          {
            "node": "Material - PDF1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Webhook Media": {
      "main": [
        [
          {
            "node": "Edit Fields Img 4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields Img 5": {
      "main": [
        [
          {
            "node": "Wait5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Lead6": {
      "main": [
        [
          {
            "node": "Get Empreendimento 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If6": {
      "main": [
        [
          {
            "node": "Simulacao",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait5": {
      "main": [
        [
          {
            "node": "Get Lead6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Empreendimento 3": {
      "main": [
        [
          {
            "node": "If6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simulacao": {
      "main": [
        [
          {
            "node": "Mover simulacao1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Simulacao": {
      "main": [
        [
          {
            "node": "Edit Fields Img 5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mover simulacao1": {
      "main": [
        [
          {
            "node": "Edit Fields16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields motivo": {
      "main": [
        [
          {
            "node": "Update motivo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook motivo": {
      "main": [
        [
          {
            "node": "Edit Fields motivo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields data_visita": {
      "main": [
        [
          {
            "node": "Update data_visita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook data_visita": {
      "main": [
        [
          {
            "node": "Edit Fields data_visita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-10-24T05:55:00.949Z",
  "id": "hzuEuhPpSI5wsGKH",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "[Tools] - Preencher card e Mover Lead",
  "nodes": [
    {
      "parameters": {
        "content": "## Request Human\n",
        "height": 260,
        "width": 668
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        2560
      ],
      "typeVersion": 1,
      "id": "a8e1bb07-3f99-4d3a-a4a7-382c5c9febcd",
      "name": "Sticky Note14",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.body.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "responsible_user_id",
              "value": "={{12899955}}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3104,
        2656
      ],
      "id": "f8fc247d-491f-40ef-83b5-7f932f9c9ed9",
      "name": "Request Human",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7a182e9d-33b0-419b-a8bb-1630f214ec94",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "432eddbd-512a-4d88-98fe-0eff54142c1a",
              "name": "name",
              "value": "={{ $json.body.name }}",
              "type": "string"
            },
            {
              "id": "d19b412c-289d-491b-9d3e-a46c4bc38b64",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            },
            {
              "id": "2d26539b-f258-4c4b-b41e-1b41ed70e483",
              "name": "contact_id",
              "value": "={{ $json.body.contact_id }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2160,
        -160
      ],
      "id": "fe85f5ee-6c48-4414-897c-33dc9d2adaf4",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "content": "## Preenche Nome\n",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1824,
        -240
      ],
      "typeVersion": 1,
      "id": "04131520-5e09-4431-af65-faf5f9d56c85",
      "name": "Sticky Note19"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/contacts/{{ $json.contact_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "name",
              "value": "={{$json.name}}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2368,
        -160
      ],
      "id": "75e70a31-938b-43e5-acee-d4b55aa7fa4f",
      "name": "Update Name",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "233276e9-fd98-46c4-a8e4-6be36738a6ec-nome",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        1920,
        -160
      ],
      "id": "9d31dce5-311c-4e22-99a7-a19fcfd876b9",
      "name": "Webhook1",
      "webhookId": "233276e9-fd98-46c4-a8e4-6be36738a6ec",
      "credentials": {
        "httpBasicAuth": {
          "id": "JkIMD1dDp2CjIaFX",
          "name": "[Tools] - Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a2b3c4d-aaaa-bbbb-cccc-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "9f8e7d6c-5555-4444-3333-222211110000",
              "name": "nacionalidade",
              "value": "={{ $json.body.nacionalidade }}",
              "type": "string"
            },
            {
              "id": "4e5f6g7h-cccc-dddd-eeee-444455556666",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            },
            {
              "id": "8b521ce5-8374-421b-9248-e7f3a1cf34f8",
              "name": "contact_id",
              "value": "={{ $json.body.contact_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1248,
        1248
      ],
      "id": "683d4582-168a-47d0-aa65-c7878202d150",
      "name": "Edit Fields Nacionalidade",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Preenche Nacionalidade\n",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1584,
        1168
      ],
      "typeVersion": 1,
      "id": "dadc6044-64df-42c4-b44e-a8fa7faaeabb",
      "name": "Sticky Note Nacionalidade",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/contacts/{{ $json.contact_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [\n    {\n      \"field_id\": 200442,\n      \"field_name\": \"Nacionalidade\",\n      \"values\": [\n        {\n          \"value\": \"{{ $json.nacionalidade }}\"\n        }\n      ]\n    }\n  ]\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -992,
        1248
      ],
      "id": "50a2e146-c1cb-424f-9786-0057588a9f41",
      "name": "Update Nacionalidade",
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "333376e9-fd98-46c4-a8e4-6be36738a6ef",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1488,
        1248
      ],
      "id": "6314e275-4cc9-49c9-b92d-cdb5ba29e81a",
      "name": "Webhook Nacionalidade",
      "webhookId": "333376e9-fd98-46c4-a8e4-6be36738a6ef",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c1c2c3c4-1111-2222-3333-444455556666",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "d1d2d3d4-aaaa-bbbb-cccc-ddddeeee0000",
              "name": "origem",
              "value": "={{ $json.body.origem.toTitleCase() }}",
              "type": "string"
            },
            {
              "id": "e1e2e3e4-9999-8888-7777-666655554444",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            },
            {
              "id": "e2d13fc5-081f-41d2-8747-9cacd3fc86ba",
              "name": "id_origem",
              "value": "={{\n{\n    \"Instagram\": 164566,\n    \"Facebook\": 164568,\n    \"Google\": 164570,\n    \"Indicação\": 164572,\n    \"Imprensa\": 164574\n}[$json.body.origem]\n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1248,
        1568
      ],
      "id": "fc5650e2-bc68-4cc1-b134-93a610239add",
      "name": "Edit Fields Origem",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Preenche Origem do Lead\n",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1584,
        1488
      ],
      "typeVersion": 1,
      "id": "73de01ea-1ebe-4d6c-9022-75712c66b462",
      "name": "Sticky Note Origem",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [{\n    \"field_id\": 200494,\n    \"values\": [\n      {\n        \"enum_id\": {{ $json.id_origem }}\n      }\n    ]\n  }]\n} ",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -992,
        1568
      ],
      "id": "bdf3dda1-6867-43ee-bea4-7a41890bb64b",
      "name": "Update Origem",
      "retryOnFail": true,
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "444476e9-fd98-46c4-a8e4-6be36738a6e4",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1488,
        1568
      ],
      "id": "668fa13b-ee22-4ae0-a329-27cb4980301c",
      "name": "Webhook Origem",
      "webhookId": "444476e9-fd98-46c4-a8e4-6be36738a6e4",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ab12cd34-0000-0000-0000-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "ef34gh56-1111-2222-3333-444455556666",
              "name": "servico",
              "value": "={{ $json.body.servico.toSnakeCase().replaceSpecialChars() }}",
              "type": "string"
            },
            {
              "id": "ij78kl90-7777-8888-9999-000001111122",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            },
            {
              "id": "83b44106-652c-4b7d-b4f5-8584bf236694",
              "name": "id_servico",
              "value": "={{\nlista = {\n    \"visto\": 164292,\n    \"nacionalidade_portuguesa\": 164294,\n    \"regularizacao_de_imigrantes\": 164296,\n    \"emissao_de_documentos\": 164298,\n    \"empresas\": 164300,\n    \"outros_servicos_juridicos\": 164576,\n    \"direitos_da_familia\": 164578\n}[$json.body.servico.toSnakeCase().replaceSpecialChars()]\n\n}}",
              "type": "string"
            },
            {
              "id": "5ebfd4cb-4368-448b-86d4-d218db04ca93",
              "name": "status_id",
              "value": "={{ $json.body.status_id }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -400,
        800
      ],
      "id": "1164f496-85f3-4e35-939d-3977601dc7b6",
      "name": "Edit Fields Serviço",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Preenche Serviço de Interesse\n",
        "height": 340,
        "width": 1440
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -704,
        720
      ],
      "typeVersion": 1,
      "id": "9ae3e9bb-5a96-4e5e-a903-bc04267e2d3f",
      "name": "Sticky Note Serviço",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [{\n    \"field_id\": 200128,\n    \"field_name\": \"Serviço\",\n    \"values\": [\n      {\n        \"enum_id\": {{ $json.id_servico }}\n      }\n    ]\n  }]\n} \n\n",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        32,
        752
      ],
      "id": "d78a1d76-9e4a-4b91-bd9c-6ef4dbf9cd26",
      "name": "Update Serviço",
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "555576e9-fd98-46c4-a8e4-6be36738a6e5",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -608,
        800
      ],
      "id": "cb77ed15-a750-46c1-9934-784c6916f6c5",
      "name": "Webhook Serviço",
      "webhookId": "555576e9-fd98-46c4-a8e4-6be36738a6e5",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ac12bd34-1234-5678-9012-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "bc34cd56-2121-2222-2323-242424242424",
              "name": "motivo_visto",
              "value": "={{ $json.body.motivo_visto }}",
              "type": "string"
            },
            {
              "id": "cd56de78-3232-3333-3434-353535353535",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -368,
        1232
      ],
      "id": "2bb38687-7738-4e90-81fe-88388747d63a",
      "name": "Edit Motivo Visto",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Preenche Motivo de Mudança para Visto\n",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -704,
        1152
      ],
      "typeVersion": 1,
      "id": "fea5fa27-0c40-4361-956e-809fd601512e",
      "name": "Sticky Note Motivo Visto",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [\n    {\n      \"field_id\": 200548,\n      \"values\": [\n        {\n          \"value\": \"{{ $json.motivo_visto }}\"\n        }\n      ]\n    }\n  ]\n}\n",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -112,
        1232
      ],
      "id": "b88bb9b5-9967-4f47-96c4-b8ba2e6d750b",
      "name": "Update Motivo Visto",
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "666676e9-fd98-46c4-a8e4-6be36738a6e6",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -608,
        1232
      ],
      "id": "0f56583e-a217-422c-ab6f-a6cb56b0d475",
      "name": "Webhook Motivo Visto",
      "webhookId": "666676e9-fd98-46c4-a8e4-6be36738a6e6",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "de12ad34-0000-1111-2222-333344445555",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "fa23bc67-3333-4444-5555-666677778888",
              "name": "tipo_visto",
              "value": "={{ $json.body.tipo_visto }}",
              "type": "string"
            },
            {
              "id": "bc45de89-7777-8888-9999-000011112222",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            },
            {
              "id": "e6cb15a8-b8e7-4e57-876a-4a574ffe50b7",
              "name": "id_visto",
              "value": "={{ \n$json.body.tipo_visto.isNumeric()? $json.body.tipo_visto :\n\nlista = {\n    \"turismo\": 164404,\n    \"trabalho_sazonal\": 164406,\n    \"e1_tratamento_medico\": 164408,\n    \"e9_estudante_temporario\": 164410,\n    \"e_atividade_profissional_independente\": 164412,\n    \"d1_trabalho_subordinado\": 164414,\n    \"d2_empreendedores_e_trabalhadores_independentes\": 164416,\n    \"d3_atividade_altamente_qualificada\": 164418,\n    \"d4_estudantes_de_longa_duracao\": 164420,\n    \"d7_visto_de_rendimentos\": 164422,\n    \"d8_nomade_digital\": 164424,\n    \"procura_de_trabalho\": 164426,\n    \"golden_visa\": 164428,\n    \"reagrupamento_familiar\": 164430\n}[$json.body.tipo_visto]\n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -368,
        1536
      ],
      "id": "5fb3d809-bd30-4bfb-a1cb-4beedb7084e2",
      "name": "Edit Tipo Visto",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Preenche Tipo do Visto\n",
        "height": 244,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -704,
        1472
      ],
      "typeVersion": 1,
      "id": "3ad4ba9a-29c5-4106-a7f7-add8ebb6419f",
      "name": "Sticky Note Tipo Visto",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [{\n    \"field_id\": 200278,\n    \"values\": [\n      {\n        \"enum_id\": {{ $json.id_visto }}\n      }\n    ]\n  }]\n} ",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -112,
        1536
      ],
      "id": "59972f87-2177-407d-ba35-e94483b81baa",
      "name": "Update Tipo Visto",
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "777776e9-fd98-46c4-a8e4-6be36738a6e7",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -608,
        1536
      ],
      "id": "f125f8e5-46a0-4ad2-834f-134fd29548e6",
      "name": "Webhook Tipo Visto",
      "webhookId": "777776e9-fd98-46c4-a8e4-6be36738a6e7",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Move para Venda Perdida\nChame quando o lead estiver fora do perfil.",
        "height": 260,
        "width": 784
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -704,
        1760
      ],
      "id": "b69cb51e-5e73-4cad-b178-74b401aff831",
      "name": "Sticky Note Venda Perdida",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a1e2i3o4-u1u2-u3u4-u5u6-u7u8u9u0",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "b1e2i3o4-c1c2-c3c4-c5c6-c7c8c9c0",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -384,
        1840
      ],
      "id": "3ed9e021-96ba-4002-9b8f-65e65846ccdb",
      "name": "Edit Fields Venda Perdida",
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "888886e9-fd98-46c4-a8e4-6be36738a6e8",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -608,
        1840
      ],
      "id": "5da53896-9a63-44d9-97a5-ab50c33dce62",
      "name": "Webhook Venda Perdida",
      "webhookId": "888886e9-fd98-46c4-a8e4-6be36738a6e8",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "status_id",
              "value": "={{12345678}}"
            },
            {
              "name": "lose_reason",
              "value": "Fora de Perfil"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -128,
        1840
      ],
      "id": "09f35ef1-d796-40c8-953a-fcb02c5db6e0",
      "name": "Mover Lead para VENDA PERDIDA",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $('Edit Fields Serviço').item.json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "status_id",
              "value": "={{89500460}}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        544,
        768
      ],
      "id": "88e60a62-1c0f-4487-be39-d64da0ba52ad",
      "name": "Move Lead to LEVANTAMENTO INFOS",
      "disabled": true
    },
    {
      "parameters": {
        "url": "=https://joiceadv.kommo.com/api/v4/leads/1604460",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "with",
              "value": "contacts,companies"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -368,
        -128
      ],
      "id": "d0d3bc75-af73-403a-b093-ff2dfdd89304",
      "name": "Get Lead",
      "disabled": true
    },
    {
      "parameters": {
        "url": "=https://joiceadv.kommo.com/api/v4/contacts/{{ $json._embedded.contacts.first().id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -176,
        -128
      ],
      "id": "f8b69cdc-8e14-45da-a2b7-7e2c90b7ab43",
      "name": "Get Contact",
      "disabled": true
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -624,
        -128
      ],
      "id": "7887dc09-07a5-419e-84c1-e668694f0b70",
      "name": "When clicking ‘Execute workflow’",
      "disabled": true
    },
    {
      "parameters": {
        "url": "https://joiceadv.kommo.com/api/v4/leads/custom_fields/200278",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        112,
        -128
      ],
      "id": "fe5860a2-c546-4f30-8177-2fd83e1b1125",
      "name": "Get Custom Field",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Testes\n",
        "height": 596,
        "width": 1460
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -704,
        -224
      ],
      "typeVersion": 1,
      "id": "8a4023b1-0c89-4038-a680-4fe8e46a1584",
      "name": "Sticky Note17",
      "disabled": true
    },
    {
      "parameters": {
        "url": "https://joiceadv.kommo.com/api/v4/leads/pipelines/11649772/statuses",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        352,
        -128
      ],
      "id": "dc4ecc08-4edb-4026-9c2c-7dfa629d29ae",
      "name": "Get Pipeline Stages",
      "disabled": true
    },
    {
      "parameters": {
        "url": "https://joiceadv.kommo.com/api/v4/users",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        112,
        64
      ],
      "id": "d3d6c910-b5e4-4a35-a6ac-a00535e8a23e",
      "name": "Get Users",
      "disabled": true
    },
    {
      "parameters": {
        "url": "https://joiceadv.kommo.com/api/v4/leads/pipelines",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        576,
        -128
      ],
      "id": "2fe2bc30-3152-4ea2-aaa0-4ef103082aa8",
      "name": "Get Pipelines",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "https://joiceadv.kommo.com/api/v4/leads/21811099",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"custom_fields_values\": [\n    \n    {\n      \"field_id\": 1569161,\n      \"values\": [\n        {\n          \"value\": \"Casado\"\n        }\n      ]\n    }\n  ]\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        352,
        64
      ],
      "id": "6aec8a79-b64b-4729-80e9-26c85435518e",
      "name": "Update Lead",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "CREATE SCHEMA IF NOT EXISTS kommo;\n\nCREATE TABLE kommo.metadata (\n  id SERIAL PRIMARY KEY,\n   \"order\" NUMERIC(20, 18),\n   \"Name\" TEXT,\n   acces_token TEXT,\n   expired_at TIMESTAMP WITH TIME ZONE,\n   amojo_id TEXT\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        576,
        80
      ],
      "id": "8a89a6f5-7b53-454c-bd58-44e8ff06a89f",
      "name": "Execute a SQL query",
      "disabled": true
    },
    {
      "parameters": {
        "mode": "delete"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryManager",
      "typeVersion": 1.1,
      "position": [
        -400,
        80
      ],
      "id": "cc0f5934-d4cc-469c-a7e7-0c529679f8ff",
      "name": "Chat Memory Manager1",
      "disabled": true
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "=7b62a90e-227a-47be-a0a2-6ffdfee5ddd7-1",
        "contextWindowLength": 25
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -576,
        112
      ],
      "id": "696d3cb4-4701-44ab-b5cb-1e3118470e4d",
      "name": "Postgres Chat Memory1",
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "6adf4b3d-08f7-4b81-ba25-5abdd7995602",
              "leftValue": "={{ [89500452,89500456] }}",
              "rightValue": "={{ $('Edit Fields Serviço').item.json.status_id }}",
              "operator": {
                "type": "array",
                "operation": "contains",
                "rightType": "any"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        256,
        752
      ],
      "id": "effcbffa-d680-48ae-bf3f-bff00b65ad92",
      "name": "Mover Lead",
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "8d0d79d7-f70f-4cd2-9705-5fca63cf80e2",
              "leftValue": "={{ $json.id_servico }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -192,
        800
      ],
      "id": "3825585b-5210-4ed2-8476-2cf151f7d492",
      "name": "If1",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c3a9a6a9-0fc2-4f70-8f57-00a1721c329a",
              "name": "Output",
              "value": "Opção inválida, por favor, tente novamente com uma das seguintes: \n`visto`, `nacionalidade_portuguesa`, `regularizacao_de_imigrantes`, `emissao_de_documentos`, `empresas`, `outros_servicos_juridicos`, `direitos_da_familia`\nenvie exatamente como está aqui",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        32,
        912
      ],
      "id": "7690c7e7-17e2-43cb-a7d8-52600e4c5540",
      "name": "Edit Fields2",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c1c2c3c4-1111-2222-3333-444455556666",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "d1d2d3d4-aaaa-bbbb-cccc-ddddeeee0000",
              "name": "urgencia",
              "value": "={{ $json.body.urgencia }}",
              "type": "string"
            },
            {
              "id": "e1e2e3e4-9999-8888-7777-666655554444",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            },
            {
              "id": "e2d13fc5-081f-41d2-8747-9cacd3fc86ba",
              "name": "id_urgencia",
              "value": "={{ \n  (() => {\n    const listaUrgencia = {\n      1: 1213372, // Já está na cidade\n      2: 1213374, // Virá em até 60 dias\n      3: 1213376, // Viagem programada para depois de 60 dias\n      4: 1213378  // Não sabe quando viajará\n    };\n    return listaUrgencia[$json.body.urgencia] || 0;\n  })()\n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1184,
        176
      ],
      "id": "806a40f3-866f-450b-8bef-c564c5f5bff4",
      "name": "Edit Fields urgencia",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Preenche urgencia do Lead\n",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        848,
        96
      ],
      "typeVersion": 1,
      "id": "2a779689-51fe-4fde-ad55-e4e34355b2b9",
      "name": "Sticky Note urgencia",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [{\n    \"field_id\": 1390574,\n    \"values\": [\n      {\n        \"enum_id\": {{ $json.id_urgencia }}\n      }\n    ]\n  }]\n} ",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1440,
        176
      ],
      "id": "9fd48d94-0a57-4a66-bde2-37c64cc8141e",
      "name": "Update urgencia",
      "retryOnFail": true,
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "444476e9-fd98-46c4-a8e4-6be36738a6e4",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        944,
        176
      ],
      "id": "8b7a7c94-07a6-4690-b84c-778c32b51d5d",
      "name": "Webhook urgencia",
      "webhookId": "444476e9-fd98-46c4-a8e4-6be36738a6e4",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a2b3c4d-aaaa-bbbb-cccc-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "9f8e7d6c-5555-4444-3333-222211110000",
              "name": "data_chegada",
              "value": "={{ $json.body.data_chegada }}",
              "type": "string"
            },
            {
              "id": "4e5f6g7h-cccc-dddd-eeee-444455556666",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1184,
        464
      ],
      "id": "021b85d4-3f42-4d6f-a720-aefef9439b03",
      "name": "Edit Fields data_chegada",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Preenche data_chegada\n",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        848,
        384
      ],
      "typeVersion": 1,
      "id": "b394dae1-0260-495b-bfb9-1c50d332f229",
      "name": "Sticky Note data_chegada",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [\n    {\n      \"field_id\": 1390568,\n      \"values\": [\n        {\n          \"value\": {{ $json.data_chegada.toDateTime().toSeconds() }}\n        }\n      ]\n    }\n  ]\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1440,
        464
      ],
      "id": "2138bac9-68ad-4328-85a6-2bf3b8153e2d",
      "name": "Update data_chegada",
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "333376e9-fd98-46c4-a8e4-6be36738a6ef",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        944,
        464
      ],
      "id": "144c7b27-965f-4e49-9527-7895aaa444f2",
      "name": "Webhook data_chegada",
      "webhookId": "333376e9-fd98-46c4-a8e4-6be36738a6ef",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a2b3c4d-aaaa-bbbb-cccc-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "9f8e7d6c-5555-4444-3333-222211110000",
              "name": "data_partida",
              "value": "={{ $json.body.data_partida }}",
              "type": "string"
            },
            {
              "id": "4e5f6g7h-cccc-dddd-eeee-444455556666",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1184,
        752
      ],
      "id": "bf1a107c-5615-4ce0-a209-325e8d91ac5f",
      "name": "Edit Fields data_partida",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Preenche data_partida\n- Campo de Data",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        848,
        672
      ],
      "typeVersion": 1,
      "id": "e5c2b161-971c-4a0e-9c7c-a8b600027676",
      "name": "Sticky Note data_partida",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [\n    {\n      \"field_id\": 1390570,\n      \"values\": [\n        {\n          \"value\": {{ $json.data_partida.toDateTime().toSeconds() }}\n        }\n      ]\n    }\n  ]\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1440,
        752
      ],
      "id": "2793e1ec-b263-4729-b897-11380fb617eb",
      "name": "Update data_partida",
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "333376e9-fd98-46c4-a8e4-6be36738a6ef-data_partida",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        944,
        752
      ],
      "id": "27d9c3d1-7fb1-473a-9799-f21ee311131d",
      "name": "Webhook data_partida",
      "webhookId": "333376e9-fd98-46c4-a8e4-6be36738a6ef",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c1c2c3c4-1111-2222-3333-444455556666",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "d1d2d3d4-aaaa-bbbb-cccc-ddddeeee0000",
              "name": "grupo",
              "value": "={{ $json.body.grupo }}",
              "type": "string"
            },
            {
              "id": "e1e2e3e4-9999-8888-7777-666655554444",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            },
            {
              "id": "e2d13fc5-081f-41d2-8747-9cacd3fc86ba",
              "name": "id_grupo",
              "value": "={{ \n  (() => {\n    const listaGrupo = {\n      1: 1213380, // Solo\n      2: 1213382, // Casal\n      3: 1213384, // Amigos\n      4: 1213386  // Família com filhos\n    };\n    return listaGrupo[$json.body.grupo] || 0;\n  })()\n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1184,
        1040
      ],
      "id": "e39a06c9-9698-4a03-8f63-76033edc0107",
      "name": "Edit Fields grupo",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Preenche grupo do Lead\n- Dropdown com seleção única",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        848,
        960
      ],
      "typeVersion": 1,
      "id": "969ccf7f-2a27-4912-8ef2-7ddacfb9dfdd",
      "name": "Sticky Note grupo",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [{\n    \"field_id\": 1390576,\n    \"values\": [\n      {\n        \"enum_id\": {{ $json.id_grupo }}\n      }\n    ]\n  }]\n} ",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1440,
        1040
      ],
      "id": "61c6fca4-0237-4bed-9bb5-2ad47b5d0c72",
      "name": "Update grupo",
      "retryOnFail": true,
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "444476e9-fd98-46c4-a8e4-6be36738a6e4-grupo",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        944,
        1040
      ],
      "id": "414c9f1d-769d-4fb8-a10b-2c701cda55ff",
      "name": "Webhook grupo",
      "webhookId": "444476e9-fd98-46c4-a8e4-6be36738a6e4",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c1c2c3c4-1111-2222-3333-444455556666",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "d1d2d3d4-aaaa-bbbb-cccc-ddddeeee0000",
              "name": "perfil",
              "value": "={{ $json.body.perfil }}",
              "type": "string"
            },
            {
              "id": "e1e2e3e4-9999-8888-7777-666655554444",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            },
            {
              "id": "e2d13fc5-081f-41d2-8747-9cacd3fc86ba",
              "name": "ids_perfil",
              "value": "={{ \n  (() => {\n    const listaperfil = {\n      1: 1213388, // Há idosos\n      2: 1213390, // Há crianças\n      3: 1213392  // Há PNE\n    };\n    // String recebida, ex: \"1,3\"\n    const input = $json.body.perfil || \"\";\n\n    // Transforma em array de números\n    const selecionados = input.split(\",\").map(v => parseInt(v.trim(), 10));\n\n  const ids = selecionados\n      .map(num => listaperfil[num])\n      .filter(Boolean);\n\n    return ids;\n  })()\n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1184,
        1344
      ],
      "id": "50c93e7f-29b5-4367-b7f2-4316962f7e4e",
      "name": "Edit Fields perfil",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Preenche perfil do Lead\n- Checkbox com multiplos preenchimentos",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        848,
        1264
      ],
      "typeVersion": 1,
      "id": "c111ede9-142b-4208-ab5c-fcae326de87b",
      "name": "Sticky Note perfil",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [{\n    \"field_id\": 1390578,\n    \"values\": [\n      {{ $json.ids_perfil.parseJson().map(id => ('{ \"enum_id\": '+id+' }')) }}\n    ]\n  }]\n} ",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1440,
        1344
      ],
      "id": "308f231a-543a-4fc9-9ad9-2d94ea9b9c26",
      "name": "Update perfil",
      "retryOnFail": true,
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "444476e9-fd98-46c4-a8e4-6be36738a6e4-perfil",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        944,
        1344
      ],
      "id": "060b7564-ca2f-4322-baf3-f9e2f1b5b682",
      "name": "Webhook perfil",
      "webhookId": "444476e9-fd98-46c4-a8e4-6be36738a6e4",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c1c2c3c4-1111-2222-3333-444455556666",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "d1d2d3d4-aaaa-bbbb-cccc-ddddeeee0000",
              "name": "passeio",
              "value": "={{ $json.body.passeio }}",
              "type": "string"
            },
            {
              "id": "e1e2e3e4-9999-8888-7777-666655554444",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            },
            {
              "id": "e2d13fc5-081f-41d2-8747-9cacd3fc86ba",
              "name": "id_passeio",
              "value": "={{ \n  (() => {\n    const listaPasseio = {\n      1: 1213402, // Em Grupo\n      2: 1213404, // Privativo\n      3: 1213406  // Compartilhado\n    };\n    return listaPasseio[$json.body.passeio] || 0;\n  })()\n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1184,
        1648
      ],
      "id": "2b5d5032-66d7-41be-97a9-638191f33941",
      "name": "Edit Fields passeio",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Preenche passeio do Lead\n- Dropdown com seleção única",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        848,
        1568
      ],
      "typeVersion": 1,
      "id": "86341f5b-0774-4011-94e5-6ed5f5d902be",
      "name": "Sticky Note passeio",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [{\n    \"field_id\": 1390582,\n    \"values\": [\n      {\n        \"enum_id\": {{ $json.id_passeio }}\n      }\n    ]\n  }]\n} ",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1440,
        1648
      ],
      "id": "8c9ec41a-3050-4351-915e-7c6d53b1abe7",
      "name": "Update passeio",
      "retryOnFail": true,
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "444476e9-fd98-46c4-a8e4-6be36738a6e4-passeio",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        944,
        1648
      ],
      "id": "69cbf597-219b-4d6a-90f4-4a443e1bc101",
      "name": "Webhook passeio",
      "webhookId": "444476e9-fd98-46c4-a8e4-6be36738a6e4",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Mover Perda\n",
        "height": 260,
        "width": 668
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1728,
        96
      ],
      "typeVersion": 1,
      "id": "6e062e15-638c-452a-a11a-6c2b9da534f3",
      "name": "Sticky Note",
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "5b6cd24d-14d5-4074-901f-0f4b11c02415-perda",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        1824,
        192
      ],
      "id": "9d10175b-d779-495a-a8f2-0a1519ae7bb5",
      "name": "Webhook Perda",
      "webhookId": "5b6cd24d-14d5-4074-901f-0f4b11c02415",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.body.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "status_id",
              "value": "={{143}}"
            },
            {
              "name": "pipeline_id",
              "value": "={{ 11533403 }}"
            },
            {
              "name": "loss_reason_id",
              "value": "={{ 31000235 }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2128,
        192
      ],
      "id": "f9d4f946-6358-4f1a-9a93-cc98d379b46e",
      "name": "Mover Perda",
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "5b6cd24d-14d5-4074-901f-0f4b11c02415-pos_vendas",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        1824,
        480
      ],
      "id": "b69ae66b-9be1-4866-adce-f999a2e8aa45",
      "name": "Webhook pos_vendas",
      "webhookId": "5b6cd24d-14d5-4074-901f-0f4b11c02415",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.body.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "status_id",
              "value": "={{87440435}}"
            },
            {
              "name": "pipeline_id",
              "value": "={{ 11390287 }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2128,
        480
      ],
      "id": "7accd346-a976-4871-a8c2-f162bbafa8d9",
      "name": "Mover pos_vendas",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Mover pos_vendas\n",
        "height": 260,
        "width": 668
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1728,
        384
      ],
      "typeVersion": 1,
      "id": "5220b614-db91-400d-a054-d6e82a7b342b",
      "name": "Sticky Note1",
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "5b6cd24d-14d5-4074-901f-0f4b11c02415-qualificado",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        1824,
        768
      ],
      "id": "0c2cdefe-3901-4ed2-a744-f0a3c0e3864e",
      "name": "Webhook qualificado",
      "webhookId": "5b6cd24d-14d5-4074-901f-0f4b11c02415",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.body.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "status_id",
              "value": "={{91042943}}"
            },
            {
              "name": "pipeline_id",
              "value": "={{ 11533403 }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2128,
        768
      ],
      "id": "90a85238-3b56-4a12-8e4d-835ce0fa0623",
      "name": "Mover qualificado",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Mover qualificado\n",
        "height": 260,
        "width": 668
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1728,
        672
      ],
      "typeVersion": 1,
      "id": "c6aee054-b412-4c9a-a90d-3cff447873f0",
      "name": "Sticky Note2",
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "5b6cd24d-14d5-4074-901f-0f4b11c02415-human",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        2800,
        2656
      ],
      "id": "c40f878e-21ef-4057-b327-5be1007458ac",
      "name": "Webhook Human",
      "webhookId": "5b6cd24d-14d5-4074-901f-0f4b11c02415",
      "credentials": {
        "httpBasicAuth": {
          "id": "JkIMD1dDp2CjIaFX",
          "name": "[Tools] - Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a2b3c4d-aaaa-bbbb-cccc-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "9f8e7d6c-5555-4444-3333-222211110000",
              "name": "pessoas",
              "value": "={{ $json.body.pessoas }}",
              "type": "string"
            },
            {
              "id": "4e5f6g7h-cccc-dddd-eeee-444455556666",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1184,
        1952
      ],
      "id": "222f40a0-8f60-44a9-bc08-6070934c6180",
      "name": "Edit Fields pessoas",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Preenche pessoas\n",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        848,
        1872
      ],
      "typeVersion": 1,
      "id": "23b4d9e4-696d-4bf3-9168-a8bbd0baae27",
      "name": "Sticky Note pessoas",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [\n    {\n      \"field_id\": 1392316,\n      \"values\": [\n        {\n          \"value\": \"{{ $json.pessoas }}\"\n        }\n      ]\n    }\n  ]\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1440,
        1952
      ],
      "id": "b643d846-8358-4624-9818-64f2f07f581f",
      "name": "Update pessoas",
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "333376e9-fd98-46c4-a8e4-6be36738a6ef-pessoas",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        944,
        1952
      ],
      "id": "7664843f-1bbe-4e16-ab4f-a454d81db771",
      "name": "Webhook pessoas",
      "webhookId": "333376e9-fd98-46c4-a8e4-6be36738a6ef",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a2b3c4d-aaaa-bbbb-cccc-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "9f8e7d6c-5555-4444-3333-222211110000",
              "name": "hospedagem",
              "value": "={{ $json.body.hospedagem }}",
              "type": "string"
            },
            {
              "id": "4e5f6g7h-cccc-dddd-eeee-444455556666",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1184,
        2256
      ],
      "id": "f68c06f0-b73e-4e66-9426-416cd9a1011d",
      "name": "Edit Fields hospedagem",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Preenche hospedagem\n",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        848,
        2176
      ],
      "typeVersion": 1,
      "id": "87f64c37-0d4e-4495-b723-e0e8b2fa208a",
      "name": "Sticky Note hospedagem",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [\n    {\n      \"field_id\": 1392314,\n      \"values\": [\n        {\n          \"value\": \"{{ $json.hospedagem }}\"\n        }\n      ]\n    }\n  ]\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1440,
        2256
      ],
      "id": "4c7ae920-d21c-40d8-99b8-5c93967a06a1",
      "name": "Update hospedagem",
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "333376e9-fd98-46c4-a8e4-6be36738a6ef-hospedagem",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        944,
        2256
      ],
      "id": "889971aa-bdd1-4a62-ae10-f5e3d070cbd6",
      "name": "Webhook hospedagem",
      "webhookId": "333376e9-fd98-46c4-a8e4-6be36738a6ef",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c1c2c3c4-1111-2222-3333-444455556666",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "d1d2d3d4-aaaa-bbbb-cccc-ddddeeee0000",
              "name": "idade_criacas",
              "value": "={{ $json.body.idade_criacas }}",
              "type": "string"
            },
            {
              "id": "e1e2e3e4-9999-8888-7777-666655554444",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            },
            {
              "id": "e2d13fc5-081f-41d2-8747-9cacd3fc86ba",
              "name": "ids_idade_criacas",
              "value": "={{ \n  (() => {\n    const listaidade_criacas = {\n      1: 1217086, // 0 a 3 anos\n      2: 1217088, // 4 a 9 anos\n      3: 1217090  // Acima de 10 anos\n    };\n    // String recebida, ex: \"1,3\"\n    const input = $json.body.idade_criacas || \"\";\n\n    // Transforma em array de números\n    const selecionados = input.split(\",\").map(v => parseInt(v.trim(), 10));\n\n  const ids = selecionados\n      .map(num => listaidade_criacas[num])\n      .filter(Boolean);\n\n    return ids;\n  })()\n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1184,
        2576
      ],
      "id": "65084f94-fe3a-4732-b6fc-489900c74f20",
      "name": "Edit Fields idade_criacas",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Preenche idade_criacas do Lead\n- Checkbox com multiplos preenchimentos",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        848,
        2496
      ],
      "typeVersion": 1,
      "id": "b4d3a192-ebe8-439e-b4fc-cee361d1a03c",
      "name": "Sticky Note idade_criacas",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [{\n    \"field_id\": 1392264,\n    \"values\": [\n      {{ $json.ids_idade_criacas.parseJson().map(id => ('{ \"enum_id\": '+id+' }')) }}\n    ]\n  }]\n} ",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1440,
        2576
      ],
      "id": "d0005324-2fcd-4abf-b951-37c843a8117d",
      "name": "Update idade_criacas",
      "retryOnFail": true,
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "444476e9-fd98-46c4-a8e4-6be36738a6e4-idade_criacas",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        944,
        2576
      ],
      "id": "2017d6b8-77e5-4386-b07f-4082d5d2c90e",
      "name": "Webhook idade_criacas",
      "webhookId": "444476e9-fd98-46c4-a8e4-6be36738a6e4",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a2b3c4d-aaaa-bbbb-cccc-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "9f8e7d6c-5555-4444-3333-222211110000",
              "name": "empreendimento",
              "value": "={{ $json.body.empreendimento }}",
              "type": "string"
            },
            {
              "id": "4e5f6g7h-cccc-dddd-eeee-444455556666",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3040,
        -144
      ],
      "id": "f1fdb2e1-1139-4350-8014-284dce00bfa2",
      "name": "Edit Fields empreendimento"
    },
    {
      "parameters": {
        "content": "## Preenche empreendimento\n",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        -224
      ],
      "typeVersion": 1,
      "id": "ad890969-73ee-407f-874a-562a7b1535f3",
      "name": "Sticky Note empreendimento",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [\n    {\n      \"field_id\": 1025278,\n      \"values\": [\n        {\n          \"value\": \"{{ $json.empreendimento }}\"\n        }\n      ]\n    }\n  ]\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3296,
        -144
      ],
      "id": "1b2e1f62-c9c5-43aa-88ae-05091b2a0a8e",
      "name": "Update empreendimento",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "333376e9-fd98-46c4-a8e4-6be36738a6ef-empreendimento",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        2800,
        -144
      ],
      "id": "210cb37b-66cc-4d49-9b16-05ea049de9ae",
      "name": "Webhook empreendimento",
      "webhookId": "333376e9-fd98-46c4-a8e4-6be36738a6ef",
      "credentials": {
        "httpBasicAuth": {
          "id": "JkIMD1dDp2CjIaFX",
          "name": "[Tools] - Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.body.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "status_id",
              "value": "={{82528359}}"
            },
            {
              "name": "pipeline_id",
              "value": "={{ 10762739 }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3056,
        -512
      ],
      "id": "888c12cf-41ae-4e73-b6c6-0fac2d87ea0b",
      "name": "Mover Interesse",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "5b6cd24d-14d5-4074-901f-0f4b11c02415-material",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        2800,
        176
      ],
      "id": "400ec1b6-fb4b-4915-b875-03858c194968",
      "name": "Webhook material",
      "webhookId": "5b6cd24d-14d5-4074-901f-0f4b11c02415",
      "credentials": {
        "httpBasicAuth": {
          "id": "JkIMD1dDp2CjIaFX",
          "name": "[Tools] - Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.body.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "status_id",
              "value": "={{91494987}}"
            },
            {
              "name": "pipeline_id",
              "value": "={{ 10762739 }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3104,
        176
      ],
      "id": "6b8377d9-7d3c-4051-9fb6-60fa4c24dae5",
      "name": "Mover material",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "content": "## Mover material\n",
        "height": 260,
        "width": 668
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        80
      ],
      "typeVersion": 1,
      "id": "4b126e38-4f7f-40de-b9da-d92dfe5623a1",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "5b6cd24d-14d5-4074-901f-0f4b11c02415-simulacao",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        2800,
        480
      ],
      "id": "db3d6d42-3983-4844-a0e3-5445f191103b",
      "name": "Webhook simulacao",
      "webhookId": "5b6cd24d-14d5-4074-901f-0f4b11c02415",
      "credentials": {
        "httpBasicAuth": {
          "id": "JkIMD1dDp2CjIaFX",
          "name": "[Tools] - Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.body.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "status_id",
              "value": "={{92937723}}"
            },
            {
              "name": "pipeline_id",
              "value": "={{ 10762739 }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3104,
        480
      ],
      "id": "ca91094b-2381-405d-8bb6-797c5f16aac9",
      "name": "Mover simulacao",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "content": "## Mover simulacao\n",
        "height": 260,
        "width": 668
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        384
      ],
      "typeVersion": 1,
      "id": "c22a3520-6f96-4b5a-b323-10c6664d9ee4",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c1c2c3c4-1111-2222-3333-444455556666",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "d1d2d3d4-aaaa-bbbb-cccc-ddddeeee0000",
              "name": "estado_civil",
              "value": "={{ $json.body.estado_civil }}",
              "type": "string"
            },
            {
              "id": "e1e2e3e4-9999-8888-7777-666655554444",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            },
            {
              "id": "e2d13fc5-081f-41d2-8747-9cacd3fc86ba",
              "name": "id_estado_civil",
              "value": "={{ \n  (() => {\n    const listaestado_civil = {\n      1: 908244, // Solteiro\n      2: 908246, // Casado\n      3: 908248  // Comprar com outra pessoa\n    };\n    return listaestado_civil[$json.body.estado_civil] || 0;\n  })()\n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3040,
        752
      ],
      "id": "39b41b8e-0aa9-4330-b23b-83c35cc8f308",
      "name": "Edit Fields estado_civil"
    },
    {
      "parameters": {
        "content": "## Preenche estado_civil do Lead\n- Dropdown com seleção única",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        672
      ],
      "typeVersion": 1,
      "id": "2e48b327-112b-4efa-9ad0-80187f660979",
      "name": "Sticky Note estado_civil"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [{\n    \"field_id\": 1061478,\n    \"values\": [\n      {\n        \"enum_id\": {{ $json.id_estado_civil }}\n      }\n    ]\n  }]\n} ",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3296,
        752
      ],
      "id": "cf98b247-d6d7-4260-9c12-0d7f828bdd3e",
      "name": "Update estado_civil",
      "retryOnFail": true,
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "444476e9-fd98-46c4-a8e4-6be36738a6e4-estado_civil",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        2800,
        752
      ],
      "id": "daee1210-23d4-434e-96df-515f1b168874",
      "name": "Webhook estado_civil",
      "webhookId": "444476e9-fd98-46c4-a8e4-6be36738a6e4",
      "credentials": {
        "httpBasicAuth": {
          "id": "JkIMD1dDp2CjIaFX",
          "name": "[Tools] - Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a2b3c4d-aaaa-bbbb-cccc-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "9f8e7d6c-5555-4444-3333-222211110000",
              "name": "renda",
              "value": "={{ $json.body.renda }}",
              "type": "string"
            },
            {
              "id": "4e5f6g7h-cccc-dddd-eeee-444455556666",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3040,
        1056
      ],
      "id": "513c490b-bbbe-423d-bc42-93b503b6beaf",
      "name": "Edit Fields renda"
    },
    {
      "parameters": {
        "content": "## Preenche renda\n",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        976
      ],
      "typeVersion": 1,
      "id": "c06d438f-de74-4197-8e80-12b4b3623fc1",
      "name": "Sticky Note renda",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [\n    {\n      \"field_id\": 1061480,\n      \"values\": [\n        {\n          \"value\": \"{{ $json.renda }}\"\n        }\n      ]\n    }\n  ]\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3296,
        1056
      ],
      "id": "d30d7cd9-57fe-43b9-96df-bb35dee56a12",
      "name": "Update renda",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "333376e9-fd98-46c4-a8e4-6be36738a6ef-renda",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        2800,
        1056
      ],
      "id": "5d08085f-7f88-40d3-93c1-7d9c694cc9c5",
      "name": "Webhook renda",
      "webhookId": "333376e9-fd98-46c4-a8e4-6be36738a6ef",
      "credentials": {
        "httpBasicAuth": {
          "id": "JkIMD1dDp2CjIaFX",
          "name": "[Tools] - Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c1c2c3c4-1111-2222-3333-444455556666",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "d1d2d3d4-aaaa-bbbb-cccc-ddddeeee0000",
              "name": "tipo_renda",
              "value": "={{ $json.body.tipo_renda }}",
              "type": "string"
            },
            {
              "id": "e1e2e3e4-9999-8888-7777-666655554444",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            },
            {
              "id": "e2d13fc5-081f-41d2-8747-9cacd3fc86ba",
              "name": "id_tipo_renda",
              "value": "={{ \n  (() => {\n    const listatipo_renda = {\n      1: 908250, // Formal\n      2: 908252, // Informal\n    };\n    return listatipo_renda[$json.body.tipo_renda] || 0;\n  })()\n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3040,
        1376
      ],
      "id": "be228c37-f772-45a7-bb85-3cd56fe402cd",
      "name": "Edit Fields tipo_renda"
    },
    {
      "parameters": {
        "content": "## Preenche tipo_renda do Lead\n- Dropdown com seleção única",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        1296
      ],
      "typeVersion": 1,
      "id": "df37af92-67f3-4274-a6b1-f50009ae7e5e",
      "name": "Sticky Note tipo_renda"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [{\n    \"field_id\": 1061482,\n    \"values\": [\n      {\n        \"enum_id\": {{ $json.id_tipo_renda }}\n      }\n    ]\n  }]\n} ",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3296,
        1376
      ],
      "id": "321ca804-7b02-4478-a66d-28be8b2539f4",
      "name": "Update tipo_renda",
      "retryOnFail": true,
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "444476e9-fd98-46c4-a8e4-6be36738a6e4-tipo_renda",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        2800,
        1376
      ],
      "id": "bb550d1c-3b4b-44df-b336-7ecc4bea7f9b",
      "name": "Webhook tipo_renda",
      "webhookId": "444476e9-fd98-46c4-a8e4-6be36738a6e4",
      "credentials": {
        "httpBasicAuth": {
          "id": "JkIMD1dDp2CjIaFX",
          "name": "[Tools] - Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c1c2c3c4-1111-2222-3333-444455556666",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "d1d2d3d4-aaaa-bbbb-cccc-ddddeeee0000",
              "name": "imposto",
              "value": "={{ $json.body.imposto }}",
              "type": "string"
            },
            {
              "id": "e1e2e3e4-9999-8888-7777-666655554444",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            },
            {
              "id": "e2d13fc5-081f-41d2-8747-9cacd3fc86ba",
              "name": "id_imposto",
              "value": "={{ \n  (() => {\n    const listaimposto = {\n      1: 908254, // Sim\n      2: 908256, // Não\n    };\n    return listaimposto[$json.body.imposto] || 0;\n  })()\n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3040,
        1696
      ],
      "id": "97e2daa2-0c29-46b9-a8a7-b2aaf87f177f",
      "name": "Edit Fields imposto"
    },
    {
      "parameters": {
        "content": "## Preenche imposto do Lead\n- Dropdown com seleção única",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        1616
      ],
      "typeVersion": 1,
      "id": "75a32c05-6a05-42f2-bb0a-be96a813df0e",
      "name": "Sticky Note imposto"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [{\n    \"field_id\": 1061484,\n    \"values\": [\n      {\n        \"enum_id\": {{ $json.id_imposto }}\n      }\n    ]\n  }]\n} ",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3296,
        1696
      ],
      "id": "9d2c126e-eb3f-47c2-af0d-ba3065192e65",
      "name": "Update imposto",
      "retryOnFail": true,
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "444476e9-fd98-46c4-a8e4-6be36738a6e4-imposto",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        2800,
        1696
      ],
      "id": "68ecdb47-54d7-491c-9ea3-38c9f221e2ae",
      "name": "Webhook imposto",
      "webhookId": "444476e9-fd98-46c4-a8e4-6be36738a6e4",
      "credentials": {
        "httpBasicAuth": {
          "id": "JkIMD1dDp2CjIaFX",
          "name": "[Tools] - Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a2b3c4d-aaaa-bbbb-cccc-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "9f8e7d6c-5555-4444-3333-222211110000",
              "name": "nascimento",
              "value": "={{ $json.body.nascimento }}",
              "type": "string"
            },
            {
              "id": "4e5f6g7h-cccc-dddd-eeee-444455556666",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3040,
        2016
      ],
      "id": "825ba64c-e616-4bec-b040-ed250c9c3230",
      "name": "Edit Fields nascimento"
    },
    {
      "parameters": {
        "content": "## Preenche nascimento\n",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        1936
      ],
      "typeVersion": 1,
      "id": "84b665f7-0506-4c42-9eba-b019ed1634d4",
      "name": "Sticky Note nascimento",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [\n    {\n      \"field_id\": 1061626,\n      \"values\": [\n        {\n          \"value\": \"{{ $json.nascimento }}\"\n        }\n      ]\n    }\n  ]\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3296,
        2016
      ],
      "id": "9e5d29d9-c616-4e1d-916c-e3416a2c3b9c",
      "name": "Update nascimento",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "333376e9-fd98-46c4-a8e4-6be36738a6ef-nascimento",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        2800,
        2016
      ],
      "id": "91e7c10c-7efc-4e68-a6b9-0a55cfd5beef",
      "name": "Webhook nascimento",
      "webhookId": "333376e9-fd98-46c4-a8e4-6be36738a6ef",
      "credentials": {
        "httpBasicAuth": {
          "id": "JkIMD1dDp2CjIaFX",
          "name": "[Tools] - Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "5b6cd24d-14d5-4074-901f-0f4b11c02415-negociacao",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        2800,
        2336
      ],
      "id": "1046a16f-8030-4203-8026-d85d48aad6c1",
      "name": "Webhook negociacao",
      "webhookId": "5b6cd24d-14d5-4074-901f-0f4b11c02415",
      "credentials": {
        "httpBasicAuth": {
          "id": "JkIMD1dDp2CjIaFX",
          "name": "[Tools] - Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.body.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "status_id",
              "value": "={{93819675}}"
            },
            {
              "name": "pipeline_id",
              "value": "={{ 10762739 }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3104,
        2336
      ],
      "id": "f0409958-c1eb-4335-a485-3b855fb9aaea",
      "name": "Mover negociacao",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "content": "## Mover negociacao\n",
        "height": 260,
        "width": 668
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        2240
      ],
      "typeVersion": 1,
      "id": "237cba22-4b13-4757-b250-7457bb443a52",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "## Envia Imagem de capa\n\n",
        "height": 420,
        "width": 1952
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3632,
        -224
      ],
      "typeVersion": 1,
      "id": "bdd5ecd8-df97-4249-989e-0ee22b1f7407",
      "name": "Sticky Note empreendimento1",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a2b3c4d-aaaa-bbbb-cccc-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "4e5f6g7h-cccc-dddd-eeee-444455556666",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3760,
        -1568
      ],
      "id": "a48bfbec-8bad-4346-a545-7255bfa7b911",
      "name": "Edit Fields Img 1"
    },
    {
      "parameters": {
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "with",
              "value": "contacts,companies"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4208,
        -1568
      ],
      "id": "f843b4a3-377f-4a56-9140-db43ff5500a4",
      "name": "Get Lead1",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1bzkWAhQJvXmtKmWjE6aFsPb4XNH9BkySg7EBCmj9GSo",
          "mode": "list",
          "cachedResultName": "Teste 1 (respostas)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1bzkWAhQJvXmtKmWjE6aFsPb4XNH9BkySg7EBCmj9GSo/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2109325036,
          "mode": "list",
          "cachedResultName": "Respostas ao formulário 1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1bzkWAhQJvXmtKmWjE6aFsPb4XNH9BkySg7EBCmj9GSo/edit#gid=2109325036"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Nome do Empreendimento",
              "lookupValue": "={{ \n  (\n    $('Get Lead1').item.json.custom_fields_values.find(item => item.field_id == 1025278) \n    || { values: [{ value: null }] }\n  ).values[0].value || ''\n}}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4432,
        -1568
      ],
      "id": "9b14b13e-072a-466c-adc2-8b2344216646",
      "name": "Get row(s) in sheet",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "mON6xvVmy3RLWJPW",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7c011ac5-a7dd-4c09-a840-f14b216bbc0e",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4656,
        -1568
      ],
      "id": "8de90c8a-8dd6-4b08-abc3-a6d0b74cf912",
      "name": "If"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "34459ceb-c139-4fb7-a50f-7d57df46e6b8",
              "name": "Output",
              "value": "Empreendimento Não encontrado ou não atrelado ao lead.\nchame novamente a ferramenta `preenche_empreendimento` para garantir que o empreendimento está preenchido e depois chame essa ferramenta novamente",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4880,
        -1472
      ],
      "id": "a2b2d5f2-f4a2-4af3-bb72-86f733c8126f",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        3984,
        -1568
      ],
      "id": "72dec88f-d2fa-4219-929b-740d2f19db6e",
      "name": "Wait",
      "webhookId": "1b03d023-5e73-4e67-8cb4-ca4ef3438ff1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://drive-c.kommo.com/v1.0/sessions",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "file_name",
              "value": "={{ $json.file_name }}"
            },
            {
              "name": "file_size",
              "value": "={{ $json.file_size }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5552,
        -1664
      ],
      "id": "a8b9c67d-3f8e-4803-b3c4-41c075624409",
      "name": "Create Session",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        },
        "httpHeaderAuth": {
          "id": "1yCcDVupD8YPq5x6",
          "name": "[Kommo] - Token - IA"
        }
      }
    },
    {
      "parameters": {
        "url": "https://drive.usercontent.google.com/uc?id=1DIqmsZAg69sTL2IBMtUMtzhyoxaHhfYV&export=download",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5760,
        -1184
      ],
      "id": "4150768a-b4a3-4de0-b8d5-9eaadc88c09a",
      "name": "Get File"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Create Session').item.json.body.upload_url }}",
        "sendBody": true,
        "contentType": "binaryData",
        "inputDataFieldName": "data",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        6000,
        -1664
      ],
      "id": "4f087595-f728-4ada-a569-e865a6fa3275",
      "name": "Upload File"
    },
    {
      "parameters": {
        "jsCode": "// Lê o binário do nó anterior (ajuste o nome do nó se necessário)\nconst binary = $input.first().binary.data;\n\n// Converte de base64 para buffer para calcular o tamanho real em bytes\nconst buffer = Buffer.from(binary.data, \"base64\");\nconst fileSize = buffer.length;\n\nreturn [\n  {\n    json: {\n      with_preview: true,\n      billable: true,\n      file_name: binary.fileName,\n      file_size: fileSize,\n      mime_type: binary.mimeType\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5328,
        -1664
      ],
      "id": "eb726a40-0960-42f2-8799-7ef72f93ab09",
      "name": "Get File Size"
    },
    {
      "parameters": {
        "jsCode": "// Pega o binário do nó anterior (ajuste o nome se necessário)\nconst inputBinary = $(\"Download file\").item.binary.data;\n\n// Converte de base64 para buffer\nconst buffer = Buffer.from(inputBinary.data, \"base64\");\n\n// Tamanho máximo da parte (ajuste conforme retorno da API Kommo)\nconst maxPartSize = 524288; // 512 KB\n\n// Cria os chunks\nconst chunks = [];\nfor (let i = 0; i < buffer.length; i += maxPartSize) {\n  const end = Math.min(i + maxPartSize, buffer.length);\n  const chunk = buffer.slice(i, end);\n  chunks.push(chunk);\n}\n\n// Retorna cada chunk como item binário separado\nreturn chunks.map((chunk, index) => {\n  return {\n    json: { part: index + 1 },\n    binary: {\n      data: {\n        data: chunk.toString(\"base64\"),\n        mimeType: inputBinary.mimeType,\n        fileName: `${inputBinary.fileName || \"file\"}_part${index + 1}`,\n      },\n    },\n  };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5776,
        -1664
      ],
      "id": "8c057393-880f-46a9-aff7-090507ea98b7",
      "name": "Split binary Chunks"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://amojo.kommo.com/v2/1f93b147-adc7-4d83-8b7d-8e3bdb218e91/sendMessage",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "stand",
              "value": "v16"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Host",
              "value": "amojo.kommo.com"
            },
            {
              "name": "Content-Length",
              "value": "473"
            },
            {
              "name": "X-Auth-Token",
              "value": "={{ $json.acces_token }}"
            },
            {
              "name": "Sec-Ch-Ua-Platform",
              "value": "\"macOS\""
            },
            {
              "name": "Accept-Language",
              "value": "pt-BR,pt;q=0.9"
            },
            {
              "name": "Sec-Ch-Ua",
              "value": "\"Not)A;Brand\";v=\"8\", \"Chromium\";v=\"138\""
            },
            {
              "name": "Sec-Ch-Ua-Mobile",
              "value": "?0"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36"
            },
            {
              "name": "Accept",
              "value": "application/json, text/javascript, */*; q=0.01"
            },
            {
              "name": "Origin",
              "value": "https://joiceadv.kommo.com"
            },
            {
              "name": "Sec-Fetch-Site",
              "value": "same-site"
            },
            {
              "name": "Sec-Fetch-Mode",
              "value": "cors"
            },
            {
              "name": "Sec-Fetch-Dest",
              "value": "empty"
            },
            {
              "name": "Referer",
              "value": "https://joiceadv.kommo.com/"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate, br"
            },
            {
              "name": "Priority",
              "value": "u=1, i"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient_id\": \"1772d23f-e9d2-4652-9f2b-e4be12aa00e6\",\n  \"group_id\": null,\n  \"text\": \"\",\n  \"crm_dialog_id\": 3685,\n  \"crm_contact_id\": 20965646,\n  \"crm_account_id\": 34332899,\n  \"crm_entity\": {\n    \"id\": 16956464,\n    \"type\": 2\n  },\n  \"attachments\": [\n    {\n      \"external_file_id\": \"{{ $('Upload File').item.json.body.uuid }}\",\n      \"external_file_vers_id\": \"{{ $('Upload File').item.json.body.version_uuid }}\",\n      \"type\": \"picture\"\n    }\n  ],\n  \"persona_name\": \"IA\",\n  \"persona_avatar\": \"https://images.kommo.com/frontend/images/interface/avatars/-1.jpeg\"\n}",
        "options": {
          "allowUnauthorizedCerts": true,
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        6224,
        -1168
      ],
      "id": "127b85ee-2800-4e04-afbd-7de48f394982",
      "name": "Send Message"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5a95b800-a83f-441d-93ea-a57f974cc31b",
              "name": "url",
              "value": "={{ $json['Imagem 1'] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4880,
        -1664
      ],
      "id": "21c2257a-7da4-4437-b4a2-7b9da931fe05",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json.url.split('=').last() }}"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        5104,
        -1664
      ],
      "id": "c170f634-4d83-43c8-9b94-4917f3dc9066",
      "name": "Download file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "M0nJC5WHz2G14Mp1",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://amojo.kommo.com/v2/{{ $('Webhook img 1').item.json.body.message_props.chat_id }}/sendMessage",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "with_video",
              "value": "true"
            },
            {
              "name": "stand",
              "value": "v16"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Accept",
              "value": "application/json, text/javascript, */*; q=0.01"
            },
            {
              "name": "Accept-Language",
              "value": "pt-BR,pt;q=0.9,en-US;q=0.8,en;q=0.7,la;q=0.6"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Origin",
              "value": "=https://{{ $('Webhook img 1').item.json.body.message_props.prefix }}.kommo.com "
            },
            {
              "name": "Referer",
              "value": "=https://{{ $('Webhook img 1').item.json.body.message_props.prefix }}.kommo.com/"
            },
            {
              "name": "Sec-Fetch-Dest",
              "value": "empty"
            },
            {
              "name": "Sec-Fetch-Mode",
              "value": "cors"
            },
            {
              "name": "Sec-Fetch-Site",
              "value": "same-site"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
            },
            {
              "name": "X-Auth-Token",
              "value": "={{ $json.acces_token }}"
            },
            {
              "name": "sec-ch-ua",
              "value": "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
            },
            {
              "name": "sec-ch-ua-mobile",
              "value": "?0"
            },
            {
              "name": "sec-ch-ua-platform",
              "value": "\"Linux\""
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient_id\": \"{{ $('Webhook img 1').item.json.body.message_props.recipient_id }}\",\n  \"group_id\": null,\n  \"text\": \"\",\n  \"crm_dialog_id\": {{ $('Webhook img 1').item.json.body.message_props.crm_dialog_id }},\n  \"crm_contact_id\": {{ $('Webhook img 1').item.json.body.message_props.crm_contact_id }},\n  \"crm_account_id\": {{ $('Webhook img 1').item.json.body.message_props.crm_account_id }},\n  \"crm_entity\": {\n    \"id\": {{ $('Webhook img 1').item.json.body.message_props.crm_entity.id }},\n    \"type\": 2\n  },\n  \"attachments\": [\n    {\n      \"external_file_id\": \"{{ $('Upload File').item.json.body.uuid }}\",\n      \"external_file_vers_id\": \"{{ $('Upload File').item.json.body.version_uuid }}\",\n      \"type\": \"picture\"\n    }\n  ],\n  \"persona_name\": \"IA\",\n  \"persona_avatar\": \"https://images.kommo.com/frontend/images/interface/avatars/-1.jpeg\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        6448,
        -1664
      ],
      "id": "6da712dc-f72d-416d-bb75-c29ea5c5c732",
      "name": "Send Message2",
      "retryOnFail": false
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "value": "kommo",
          "mode": "list",
          "cachedResultName": "kommo"
        },
        "table": {
          "__rl": true,
          "value": "metadata",
          "mode": "list",
          "cachedResultName": "metadata"
        },
        "limit": 1,
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        6224,
        -1664
      ],
      "id": "d35e3700-2998-4f6d-8a97-c1c235954120",
      "name": "Get Metadata",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "W73OMQ2Q4L81MFjv",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c383721e-3131-47a7-8df5-e197b604f215",
              "name": "output",
              "value": "Imagem enviada. Continue o fluxo perguntando se pode enviar um video do empreendimento",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        6672,
        -1664
      ],
      "id": "a72ceddf-28fa-45c3-a536-7629078572d0",
      "name": "Edit Fields4"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://amojo.kommo.com/v2/1f93b147-adc7-4d83-8b7d-8e3bdb218e91/sendMessage",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "with_video",
              "value": "true"
            },
            {
              "name": "stand",
              "value": "v16"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Accept",
              "value": "application/json, text/javascript, */*; q=0.01"
            },
            {
              "name": "Accept-Language",
              "value": "pt-BR,pt;q=0.9,en-US;q=0.8,en;q=0.7,la;q=0.6"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Origin",
              "value": "=https://joiceadv.kommo.com "
            },
            {
              "name": "Referer",
              "value": "=https://joiceadv.kommo.com/"
            },
            {
              "name": "Sec-Fetch-Dest",
              "value": "empty"
            },
            {
              "name": "Sec-Fetch-Mode",
              "value": "cors"
            },
            {
              "name": "Sec-Fetch-Site",
              "value": "same-site"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
            },
            {
              "name": "X-Auth-Token",
              "value": "={{ $json.acces_token }}"
            },
            {
              "name": "sec-ch-ua",
              "value": "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
            },
            {
              "name": "sec-ch-ua-mobile",
              "value": "?0"
            },
            {
              "name": "sec-ch-ua-platform",
              "value": "\"Linux\""
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient_id\": \"{{ $('Set message props').last().json.recipient_id }}\",\n  \"group_id\": null,\n  \"text\": \"\",\n  \"crm_dialog_id\": {{ $('Set message props').last().json.crm_dialog_id }},\n  \"crm_contact_id\": {{ $('Set message props').last().json.crm_contact_id }},\n  \"crm_account_id\": {{ $('Set message props').last().json.crm_account_id }},\n  \"crm_entity\": {\n    \"id\": {{ $('Set message props').last().json.crm_entity.id }},\n    \"type\": 2\n  },\n  \"attachments\": [\n    {\n      \"external_file_id\": \"{{ $('Upload File').item.json.body.uuid }}\",\n      \"external_file_vers_id\": \"{{ $('Upload File').item.json.body.version_uuid }}\",\n      \"type\": \"picture\"\n    }\n  ],\n  \"persona_name\": \"IA\",\n  \"persona_avatar\": \"https://images.kommo.com/frontend/images/interface/avatars/-1.jpeg\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        6000,
        -1184
      ],
      "id": "5925b664-5b15-4fa6-935f-4ba04a531808",
      "name": "Send Message3",
      "retryOnFail": false
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a2b3c4d-aaaa-bbbb-cccc-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "4e5f6g7h-cccc-dddd-eeee-444455556666",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3728,
        -2336
      ],
      "id": "b41734b6-718e-4c60-b3b1-8cde97f98603",
      "name": "Edit Fields Img "
    },
    {
      "parameters": {
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "with",
              "value": "contacts,companies"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4176,
        -2336
      ],
      "id": "935e75e2-70ed-4164-9bc3-79d863f66b95",
      "name": "Get Lead2",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1bzkWAhQJvXmtKmWjE6aFsPb4XNH9BkySg7EBCmj9GSo",
          "mode": "list",
          "cachedResultName": "Teste 1 (respostas)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1bzkWAhQJvXmtKmWjE6aFsPb4XNH9BkySg7EBCmj9GSo/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2109325036,
          "mode": "list",
          "cachedResultName": "Respostas ao formulário 1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1bzkWAhQJvXmtKmWjE6aFsPb4XNH9BkySg7EBCmj9GSo/edit#gid=2109325036"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Nome do Empreendimento",
              "lookupValue": "={{ \n  (\n    $('Get Lead2').item.json.custom_fields_values.find(item => item.field_id == 1025278) \n    || { values: [{ value: null }] }\n  ).values[0].value || ''\n}}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4400,
        -2336
      ],
      "id": "14cb65c6-d989-4679-92b1-52f009f99986",
      "name": "Get row(s) in sheet1",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "mON6xvVmy3RLWJPW",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7c011ac5-a7dd-4c09-a840-f14b216bbc0e",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4624,
        -2336
      ],
      "id": "2c848eb9-3d44-4cb8-86af-0aaa94b9865d",
      "name": "If2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "34459ceb-c139-4fb7-a50f-7d57df46e6b8",
              "name": "Output",
              "value": "Empreendimento Não encontrado ou não atrelado ao lead.\nchame novamente a ferramenta `preenche_empreendimento` para garantir que o empreendimento está preenchido e depois chame essa ferramenta novamente",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4880,
        -2080
      ],
      "id": "47739cf0-e6a9-4d67-b992-0056c57d8163",
      "name": "Edit Fields5"
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        3952,
        -2336
      ],
      "id": "be6ad046-b27c-4085-8d58-eb5e39073dd2",
      "name": "Wait1",
      "webhookId": "1b03d023-5e73-4e67-8cb4-ca4ef3438ff1"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "hPNyasIrRZAfBgY8",
          "mode": "list",
          "cachedResultUrl": "/workflow/hPNyasIrRZAfBgY8",
          "cachedResultName": "[Tool] - Enviar Midia"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "text_message": "={{ $('Get row(s) in sheet1').item.json['Texto para ser enviado com a mídia 1'] }}",
            "message_props": "={{ $('Webhook Media').item.json.body.message_props }}",
            "media_url": "={{ $('Get row(s) in sheet1').item.json['Midia 1'] }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "media_url",
              "displayName": "media_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "text_message",
              "displayName": "text_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "message_props",
              "displayName": "message_props",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        4880,
        -2352
      ],
      "id": "5f379650-4192-4683-ab38-96ef617a67c5",
      "name": "Material - Media 1"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "hPNyasIrRZAfBgY8",
          "mode": "list",
          "cachedResultUrl": "/workflow/hPNyasIrRZAfBgY8",
          "cachedResultName": "[Tool] - Enviar Midia"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "text_message": "={{ $('Get row(s) in sheet1').item.json['Texto para ser enviado com a mídia 2'] }}",
            "message_props": "={{ $('Webhook Media').item.json.body.message_props }}",
            "media_url": "={{ $('Get row(s) in sheet1').item.json['Midia 2'] }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "media_url",
              "displayName": "media_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "text_message",
              "displayName": "text_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "message_props",
              "displayName": "message_props",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        5104,
        -2352
      ],
      "id": "c3d83290-f0fb-4928-b3b0-eddd88c1a3e4",
      "name": "Material - Media 2"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "hPNyasIrRZAfBgY8",
          "mode": "list",
          "cachedResultUrl": "/workflow/hPNyasIrRZAfBgY8",
          "cachedResultName": "[Tool] - Enviar Midia"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "text_message": "={{ $('Get row(s) in sheet1').item.json['Texto para ser enviado com a mídia 3'] }}",
            "message_props": "={{ $('Webhook Media').item.json.body.message_props }}",
            "media_url": "={{ $('Get row(s) in sheet1').item.json['Midia 3'] }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "media_url",
              "displayName": "media_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "text_message",
              "displayName": "text_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "message_props",
              "displayName": "message_props",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        5328,
        -2352
      ],
      "id": "5d117f69-62a2-4055-aecc-dfb8c2d2c6db",
      "name": "Material - Media 3"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "hPNyasIrRZAfBgY8",
          "mode": "list",
          "cachedResultUrl": "/workflow/hPNyasIrRZAfBgY8",
          "cachedResultName": "[Tool] - Enviar Midia"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "text_message": "=",
            "message_props": "={{ $('Webhook Media').item.json.body.message_props }}",
            "media_url": "={{ $('Get row(s) in sheet1').item.json['Midia 4'] }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "media_url",
              "displayName": "media_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "text_message",
              "displayName": "text_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "message_props",
              "displayName": "message_props",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        5552,
        -2352
      ],
      "id": "14c2befc-5e41-4512-8fcd-8b227d1c5aa3",
      "name": "Material - Media 4"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "hPNyasIrRZAfBgY8",
          "mode": "list",
          "cachedResultUrl": "/workflow/hPNyasIrRZAfBgY8",
          "cachedResultName": "[Tool] - Enviar Midia"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "text_message": "=",
            "message_props": "={{ $('Webhook Media').item.json.body.message_props }}",
            "media_url": "={{ $('Get row(s) in sheet1').item.json['Midia 5'] }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "media_url",
              "displayName": "media_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "text_message",
              "displayName": "text_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "message_props",
              "displayName": "message_props",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        5776,
        -2352
      ],
      "id": "a21e8d18-0f5b-497d-9cba-5e5e57b88cea",
      "name": "Material - Media 5"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "value": "kommo",
          "mode": "list",
          "cachedResultName": "kommo"
        },
        "table": {
          "__rl": true,
          "value": "metadata",
          "mode": "list",
          "cachedResultName": "metadata"
        },
        "limit": 1,
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        6144,
        -2352
      ],
      "id": "5294f41c-44f0-4b36-b292-689b8e178520",
      "name": "Get Metadata1",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "W73OMQ2Q4L81MFjv",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://amojo.kommo.com/v2/{{ $('Webhook Media').item.json.body.message_props.chat_id }}/sendMessage",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "with_video",
              "value": "true"
            },
            {
              "name": "stand",
              "value": "v16"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Accept",
              "value": "application/json, text/javascript, */*; q=0.01"
            },
            {
              "name": "Accept-Language",
              "value": "pt-BR,pt;q=0.9,en-US;q=0.8,en;q=0.7,la;q=0.6"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Origin",
              "value": "=https://{{ $('Webhook Media').item.json.body.message_props.prefix }}.kommo.com "
            },
            {
              "name": "Referer",
              "value": "=https://{{ $('Webhook Media').item.json.body.message_props.prefix }}.kommo.com/"
            },
            {
              "name": "Sec-Fetch-Dest",
              "value": "empty"
            },
            {
              "name": "Sec-Fetch-Mode",
              "value": "cors"
            },
            {
              "name": "Sec-Fetch-Site",
              "value": "same-site"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
            },
            {
              "name": "X-Auth-Token",
              "value": "={{ $json.acces_token }}"
            },
            {
              "name": "sec-ch-ua",
              "value": "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
            },
            {
              "name": "sec-ch-ua-mobile",
              "value": "?0"
            },
            {
              "name": "sec-ch-ua-platform",
              "value": "\"Linux\""
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient_id\": \"{{ $('Webhook Media').item.json.body.message_props.recipient_id }}\",\n  \"group_id\": null,\n  \"text\": {{ $('Edit Fields6').item.json.Message.toJsonString() }},\n  \"crm_dialog_id\": {{ $('Webhook Media').item.json.body.message_props.crm_dialog_id }},\n  \"crm_contact_id\": {{ $('Webhook Media').item.json.body.message_props.crm_contact_id }},\n  \"crm_account_id\": {{ $('Webhook Media').item.json.body.message_props.crm_account_id }},\n  \"crm_entity\": {\n    \"id\": {{ $('Webhook Media').item.json.body.message_props.crm_entity.id }},\n    \"type\": 2\n  },\n  \"persona_name\": \"IA\",\n  \"persona_avatar\": \"https://images.kommo.com/frontend/images/interface/avatars/-1.jpeg\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        6352,
        -2352
      ],
      "id": "24eafd39-d539-43e1-8792-e7139d4767ed",
      "name": "Send Message4",
      "retryOnFail": false
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "be0f354c-24c0-4da1-9749-bcdb548b8f77",
              "name": "Message",
              "value": "✨ Gostou do material que te enviei até agora?  \nPara facilitar a sua visualização, segue o link com um 🏡 tour virtual da casa decorada!  \nVocê vai se sentir dentro do imóvel, vendo cada detalhe como se estivesse visitando pessoalmente!",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5968,
        -2352
      ],
      "id": "3790c81b-b010-42bd-b4a9-701329173ed8",
      "name": "Edit Fields6"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "hPNyasIrRZAfBgY8",
          "mode": "list",
          "cachedResultUrl": "/workflow/hPNyasIrRZAfBgY8",
          "cachedResultName": "[Tool] - Enviar Midia"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "text_message": "=📚 Para complementar as informações sobre o empreendimento, o book é essencial!  \nPor isso, já aproveitei e te encaminhei com todos os detalhes 😉  ",
            "message_props": "={{ $('Webhook Media').item.json.body.message_props }}",
            "media_url": "={{ $('Get row(s) in sheet1').item.json['PDF do empreendimento'] }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "media_url",
              "displayName": "media_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "text_message",
              "displayName": "text_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "message_props",
              "displayName": "message_props",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        6784,
        -2352
      ],
      "id": "cedc031d-bc5b-4fee-a72c-cb8eb395ca2b",
      "name": "Material - PDF"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5e4d9b61-6312-4d25-ae76-8c54c6a8432b",
              "name": "output",
              "value": "Material enviado!\nAgora mande a seguinte mensagem para o lead: \"📞 Podemos falar agora sobre os valores das casas?\"",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        6992,
        -2352
      ],
      "id": "953c9e9b-c97c-4232-97ee-4bcb5f9fba42",
      "name": "Edit Fields7"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "hPNyasIrRZAfBgY8",
          "mode": "list",
          "cachedResultUrl": "/workflow/hPNyasIrRZAfBgY8",
          "cachedResultName": "[Tool] - Enviar Midia"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "text_message": "={{ $('Get row(s) in sheet1').item.json['Link empreendimento'].toJsonString() }}",
            "message_props": "={{ $('Webhook Media').item.json.body.message_props }}",
            "media_url": "="
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "media_url",
              "displayName": "media_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "text_message",
              "displayName": "text_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "message_props",
              "displayName": "message_props",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        6560,
        -2352
      ],
      "id": "32f95eed-3a22-4ccd-a8f2-23767d156fba",
      "name": "Material - Link"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a2b3c4d-aaaa-bbbb-cccc-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "4e5f6g7h-cccc-dddd-eeee-444455556666",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5328,
        -2864
      ],
      "id": "fe1b2b53-2247-4aab-a0fc-b9f5ff634701",
      "name": "Edit Fields Img 2"
    },
    {
      "parameters": {
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "with",
              "value": "contacts,companies"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5776,
        -2864
      ],
      "id": "89a72673-c17d-4234-8b43-74d932b0f63a",
      "name": "Get Lead3",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1bzkWAhQJvXmtKmWjE6aFsPb4XNH9BkySg7EBCmj9GSo",
          "mode": "list",
          "cachedResultName": "Teste 1 (respostas)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1bzkWAhQJvXmtKmWjE6aFsPb4XNH9BkySg7EBCmj9GSo/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2109325036,
          "mode": "list",
          "cachedResultName": "Respostas ao formulário 1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1bzkWAhQJvXmtKmWjE6aFsPb4XNH9BkySg7EBCmj9GSo/edit#gid=2109325036"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Nome do Empreendimento",
              "lookupValue": "={{ \n  (\n    $('Get Lead3').item.json.custom_fields_values.find(item => item.field_id == 1025278) \n    || { values: [{ value: null }] }\n  ).values[0].value || ''\n}}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6000,
        -2864
      ],
      "id": "db5e65c8-d0c6-43ca-8b5a-1a8dff61c27b",
      "name": "Get row(s) in sheet2",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "mON6xvVmy3RLWJPW",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7c011ac5-a7dd-4c09-a840-f14b216bbc0e",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        6224,
        -2864
      ],
      "id": "5ff53a47-5ae7-47ea-a36e-3315fc9dbee0",
      "name": "If3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "34459ceb-c139-4fb7-a50f-7d57df46e6b8",
              "name": "Output",
              "value": "Empreendimento Não encontrado ou não atrelado ao lead.\nchame novamente a ferramenta `preenche_empreendimento` para garantir que o empreendimento está preenchido e depois chame essa ferramenta novamente",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        6480,
        -2608
      ],
      "id": "6d17b54b-e3ae-4f79-a548-897f72138799",
      "name": "Edit Fields8"
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        5552,
        -2864
      ],
      "id": "58f63bbb-f5a3-49e4-94d2-75f319a9d5f5",
      "name": "Wait2",
      "webhookId": "1b03d023-5e73-4e67-8cb4-ca4ef3438ff1"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "hPNyasIrRZAfBgY8",
          "mode": "list",
          "cachedResultUrl": "/workflow/hPNyasIrRZAfBgY8",
          "cachedResultName": "[Tool] - Enviar Midia"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "text_message": "={{ $json[\"Texto para ser enviado com a Imagem 2\"] }}",
            "message_props": "={{ $('Webhook Simulacao').item.json.body.message_props }}",
            "media_url": "={{ $json[\"imagem 2\"] }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "media_url",
              "displayName": "media_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "text_message",
              "displayName": "text_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "message_props",
              "displayName": "message_props",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        6480,
        -2880
      ],
      "id": "200968c5-2e81-42dd-8661-47fe06aa6551",
      "name": "Simulacao - Media"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "hPNyasIrRZAfBgY8",
          "mode": "list",
          "cachedResultUrl": "/workflow/hPNyasIrRZAfBgY8",
          "cachedResultName": "[Tool] - Enviar Midia"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "text_message": "=📊 Para saber exatamente o valor da sua entrada, das parcelas e do financiamento, precisamos fazer uma simulação personalizada.",
            "message_props": "={{ $('Webhook Simulacao').item.json.body.message_props }}",
            "media_url": "="
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "media_url",
              "displayName": "media_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "text_message",
              "displayName": "text_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "message_props",
              "displayName": "message_props",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        6704,
        -2880
      ],
      "id": "229d7219-2e51-4bc3-82ef-775ecc3a1851",
      "name": "Simulacao - Media1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5e4d9b61-6312-4d25-ae76-8c54c6a8432b",
              "name": "output",
              "value": "Mídia enviada! Continue o atendimento perguntando o estado civil",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        6960,
        -2880
      ],
      "id": "591ebd31-d80d-4ab3-8b0e-ef6b655ac25f",
      "name": "Edit Fields9"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a2b3c4d-aaaa-bbbb-cccc-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "4e5f6g7h-cccc-dddd-eeee-444455556666",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3936,
        -64
      ],
      "id": "843b57f1-826e-4703-8378-b85139349fe3",
      "name": "Edit Fields Img 3"
    },
    {
      "parameters": {
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "with",
              "value": "contacts,companies"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4384,
        -64
      ],
      "id": "24e7581a-32de-45a7-9195-e9aa6f54e995",
      "name": "Get Lead4",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        4160,
        -64
      ],
      "id": "5c245b01-a772-4d38-b4ad-234ee69b985e",
      "name": "Wait3",
      "webhookId": "1b03d023-5e73-4e67-8cb4-ca4ef3438ff1"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "ventures",
          "mode": "list",
          "cachedResultName": "ventures"
        },
        "limit": 1,
        "where": {
          "values": [
            {
              "column": "name",
              "value": "={{    (     $('Get Lead4').item.json.custom_fields_values.find(item => item.field_id == 1025278)      || { values: [{ value: null }] }   ).values[0].value || '' }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        4592,
        -64
      ],
      "id": "ccfe486a-f6f4-4abc-a349-491f50f491c8",
      "name": "Select rows from a table",
      "credentials": {
        "postgres": {
          "id": "M5tr6zjLSosI1qkl",
          "name": "Postgres FrontEnd"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7c011ac5-a7dd-4c09-a840-f14b216bbc0e",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4816,
        -64
      ],
      "id": "b8e6e1a8-716a-4221-9f5a-5be93bcc33d5",
      "name": "If4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "34459ceb-c139-4fb7-a50f-7d57df46e6b8",
              "name": "Output",
              "value": "Empreendimento Não encontrado ou não atrelado ao lead.\nchame novamente a ferramenta `preenche_empreendimento` para garantir que o empreendimento está preenchido e depois chame essa ferramenta novamente",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5040,
        32
      ],
      "id": "a216697c-a706-459f-b4e1-9f84b1293938",
      "name": "Edit Fields10"
    },
    {
      "parameters": {
        "jsCode": "const base64String = $input.first().json.base64;\n\n// Extrai mime type e o conteúdo base64 real\nconst match = base64String.match(/^data:(.+);base64,(.*)$/);\nconst mime_type = match?.[1] ?? \"application/octet-stream\";\nconst base64Data = match?.[2] ?? \"\";\n\n// Converte para buffer para calcular o tamanho real\nconst buffer = Buffer.from(base64Data, \"base64\");\nconst file_size = buffer.length;\n\n// Gera nome de arquivo baseado no mime type\nconst extension = mime_type.split(\"/\")[1] || \"bin\";\nconst file_name = `upload.${extension}`;\n\nreturn [\n  {\n    json: {\n      with_preview: true,\n      billable: true,\n      file_name,\n      file_size,\n      mime_type\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3808,
        -1200
      ],
      "id": "9496a5a0-8749-4329-8a69-824cfd3c301f",
      "name": "Get File Size1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://drive-c.kommo.com/v1.0/sessions",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "file_name",
              "value": "={{ $json.file_name }}"
            },
            {
              "name": "file_size",
              "value": "={{ $json.file_size }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4032,
        -1200
      ],
      "id": "86d53a2a-d569-49e4-8681-17e929af8c31",
      "name": "Create Session1",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        },
        "httpHeaderAuth": {
          "id": "1yCcDVupD8YPq5x6",
          "name": "[Kommo] - Token - IA"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Lê a string base64 do nó \"Set base64\"\nconst base64String = $(\"Set base64\").item.json.base64;\n\n// Extrai apenas o conteúdo base64 real (caso venha no formato data:mime;base64,xxx)\nconst match = base64String.match(/^data:(.+);base64,(.*)$/);\nconst mimeType = match?.[1] ?? \"application/octet-stream\";\nconst base64Data = match?.[2] ?? base64String;\n\n// Converte para buffer\nconst buffer = Buffer.from(base64Data, \"base64\");\n\n// Tamanho máximo da parte (Kommo: máx. ~512 KB por chunk)\nconst maxPartSize = 524288;\n\n// Cria os chunks\nconst chunks = [];\nfor (let i = 0; i < buffer.length; i += maxPartSize) {\n  const end = Math.min(i + maxPartSize, buffer.length);\n  const chunk = buffer.slice(i, end);\n  chunks.push(chunk);\n}\n\n// Nome base do arquivo\nconst ext = mimeType.split(\"/\")[1] || \"bin\";\nconst baseFileName = `upload.${ext}`;\n\n// Retorna cada parte como item binário\nreturn chunks.map((chunk, index) => ({\n  json: { part: index + 1 },\n  binary: {\n    data: {\n      data: chunk.toString(\"base64\"),\n      mimeType: mimeType,\n      fileName: `${baseFileName}_part${index + 1}`,\n    },\n  },\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4272,
        -1200
      ],
      "id": "69a71d79-c18e-4f28-ad8c-b1708df8dc25",
      "name": "Split binary Chunks1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5a95b800-a83f-441d-93ea-a57f974cc31b",
              "name": "base64",
              "value": "={{ $json.coverImage }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5040,
        -160
      ],
      "id": "41dbe823-fd9d-4fef-8fad-618f8245291a",
      "name": "Set base64"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Create Session1').item.json.body.upload_url }}",
        "sendBody": true,
        "contentType": "binaryData",
        "inputDataFieldName": "data",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4496,
        -1200
      ],
      "id": "f8ddf730-9387-4f2a-9499-80b9cdc4f379",
      "name": "Upload File1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://amojo.kommo.com/v2/{{ $('Webhook img 1').item.json.body.message_props.chat_id }}/sendMessage",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "with_video",
              "value": "true"
            },
            {
              "name": "stand",
              "value": "v16"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Accept",
              "value": "application/json, text/javascript, */*; q=0.01"
            },
            {
              "name": "Accept-Language",
              "value": "pt-BR,pt;q=0.9,en-US;q=0.8,en;q=0.7,la;q=0.6"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Origin",
              "value": "=https://{{ $('Webhook img 1').item.json.body.message_props.prefix }}.kommo.com "
            },
            {
              "name": "Referer",
              "value": "=https://{{ $('Webhook img 1').item.json.body.message_props.prefix }}.kommo.com/"
            },
            {
              "name": "Sec-Fetch-Dest",
              "value": "empty"
            },
            {
              "name": "Sec-Fetch-Mode",
              "value": "cors"
            },
            {
              "name": "Sec-Fetch-Site",
              "value": "same-site"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
            },
            {
              "name": "X-Auth-Token",
              "value": "={{ $json.acces_token }}"
            },
            {
              "name": "sec-ch-ua",
              "value": "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
            },
            {
              "name": "sec-ch-ua-mobile",
              "value": "?0"
            },
            {
              "name": "sec-ch-ua-platform",
              "value": "\"Linux\""
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient_id\": \"{{ $('Webhook img 1').item.json.body.message_props.recipient_id }}\",\n  \"group_id\": null,\n  \"text\": \"\",\n  \"crm_dialog_id\": {{ $('Webhook img 1').item.json.body.message_props.crm_dialog_id }},\n  \"crm_contact_id\": {{ $('Webhook img 1').item.json.body.message_props.crm_contact_id }},\n  \"crm_account_id\": {{ $('Webhook img 1').item.json.body.message_props.crm_account_id }},\n  \"crm_entity\": {\n    \"id\": {{ $('Webhook img 1').item.json.body.message_props.crm_entity.id }},\n    \"type\": 2\n  },\n  \"attachments\": [\n    {\n      \"external_file_id\": \"{{ $('Upload File1').item.json.body.uuid }}\",\n      \"external_file_vers_id\": \"{{ $('Upload File1').item.json.body.version_uuid }}\",\n      \"type\": \"picture\"\n    }\n  ],\n  \"persona_name\": \"IA\",\n  \"persona_avatar\": \"https://images.kommo.com/frontend/images/interface/avatars/-1.jpeg\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4928,
        -1200
      ],
      "id": "8c52b6f4-9d49-4200-a11c-85f353e22cde",
      "name": "Send Message5",
      "retryOnFail": false
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "value": "kommo",
          "mode": "list",
          "cachedResultName": "kommo"
        },
        "table": {
          "__rl": true,
          "value": "metadata",
          "mode": "list",
          "cachedResultName": "metadata"
        },
        "limit": 1,
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        4704,
        -1200
      ],
      "id": "988c8a98-a252-46b1-a74a-8b788a0453dd",
      "name": "Get Metadata2",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "W73OMQ2Q4L81MFjv",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c383721e-3131-47a7-8df5-e197b604f215",
              "name": "output",
              "value": "Imagem enviada. Continue o fluxo perguntando se pode enviar um video do empreendimento",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5152,
        -1200
      ],
      "id": "6b0af56f-458f-4e9e-a774-ea88276079c0",
      "name": "Edit Fields11"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "333376e9-fd98-46c4-a8e4-6be36738a6ef-img-1",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        3728,
        -64
      ],
      "id": "7cf28943-43cb-4396-bf1c-f693b8dfb888",
      "name": "Webhook img 1",
      "webhookId": "333376e9-fd98-46c4-a8e4-6be36738a6ef",
      "credentials": {
        "httpBasicAuth": {
          "id": "JkIMD1dDp2CjIaFX",
          "name": "[Tools] - Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a2b3c4d-aaaa-bbbb-cccc-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "4e5f6g7h-cccc-dddd-eeee-444455556666",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3936,
        464
      ],
      "id": "7579b30f-353d-4453-b043-4bb60cb14cd9",
      "name": "Edit Fields Img 4"
    },
    {
      "parameters": {
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "with",
              "value": "contacts,companies"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4384,
        464
      ],
      "id": "cbe620a1-60d4-4e35-a7ef-d0791f19e54b",
      "name": "Get Lead5",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7c011ac5-a7dd-4c09-a840-f14b216bbc0e",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4832,
        464
      ],
      "id": "fa4b5af3-e428-4c5f-973d-d74707591362",
      "name": "If5"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "34459ceb-c139-4fb7-a50f-7d57df46e6b8",
              "name": "Output",
              "value": "Empreendimento Não encontrado ou não atrelado ao lead.\nchame novamente a ferramenta `preenche_empreendimento` para garantir que o empreendimento está preenchido e depois chame essa ferramenta novamente",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5056,
        560
      ],
      "id": "841fb61c-c1ad-448b-8451-0b0140f11aa2",
      "name": "Edit Fields12"
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        4160,
        464
      ],
      "id": "5e969004-4cad-4a9d-a50e-c927b5c55d98",
      "name": "Wait4",
      "webhookId": "1b03d023-5e73-4e67-8cb4-ca4ef3438ff1"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "hPNyasIrRZAfBgY8",
          "mode": "list",
          "cachedResultUrl": "/workflow/hPNyasIrRZAfBgY8",
          "cachedResultName": "[Tool] - Enviar Midia"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "text_message": "={{ $json.text }}",
            "message_props": "={{ $('Webhook Media').item.json.body.message_props }}",
            "media_url": "={{ $json.url }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "media_url",
              "displayName": "media_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "text_message",
              "displayName": "text_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "message_props",
              "displayName": "message_props",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        5536,
        544
      ],
      "id": "0428b24d-81cf-4b03-bedb-17e30d9f52e1",
      "name": "Material - Media "
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "value": "kommo",
          "mode": "list",
          "cachedResultName": "kommo"
        },
        "table": {
          "__rl": true,
          "value": "metadata",
          "mode": "list",
          "cachedResultName": "metadata"
        },
        "limit": 1,
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        5712,
        448
      ],
      "id": "c9930cf0-ab92-4eb3-9410-cad93e2a4aa3",
      "name": "Get Metadata3",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "postgres": {
          "id": "W73OMQ2Q4L81MFjv",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://amojo.kommo.com/v2/{{ $('Webhook Media').item.json.body.message_props.chat_id }}/sendMessage",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "with_video",
              "value": "true"
            },
            {
              "name": "stand",
              "value": "v16"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Accept",
              "value": "application/json, text/javascript, */*; q=0.01"
            },
            {
              "name": "Accept-Language",
              "value": "pt-BR,pt;q=0.9,en-US;q=0.8,en;q=0.7,la;q=0.6"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Origin",
              "value": "=https://{{ $('Webhook Media').item.json.body.message_props.prefix }}.kommo.com "
            },
            {
              "name": "Referer",
              "value": "=https://{{ $('Webhook Media').item.json.body.message_props.prefix }}.kommo.com/"
            },
            {
              "name": "Sec-Fetch-Dest",
              "value": "empty"
            },
            {
              "name": "Sec-Fetch-Mode",
              "value": "cors"
            },
            {
              "name": "Sec-Fetch-Site",
              "value": "same-site"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
            },
            {
              "name": "X-Auth-Token",
              "value": "={{ $('Get Metadata3').item.json.acces_token }}"
            },
            {
              "name": "sec-ch-ua",
              "value": "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
            },
            {
              "name": "sec-ch-ua-mobile",
              "value": "?0"
            },
            {
              "name": "sec-ch-ua-platform",
              "value": "\"Linux\""
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient_id\": \"{{ $('Webhook Media').item.json.body.message_props.recipient_id }}\",\n  \"group_id\": null,\n  \"text\": {{ $('Edit Fields13').item.json.Message.toJsonString() }},\n  \"crm_dialog_id\": {{ $('Webhook Media').item.json.body.message_props.crm_dialog_id }},\n  \"crm_contact_id\": {{ $('Webhook Media').item.json.body.message_props.crm_contact_id }},\n  \"crm_account_id\": {{ $('Webhook Media').item.json.body.message_props.crm_account_id }},\n  \"crm_entity\": {\n    \"id\": {{ $('Webhook Media').item.json.body.message_props.crm_entity.id }},\n    \"type\": 2\n  },\n  \"persona_name\": \"IA\",\n  \"persona_avatar\": \"https://images.kommo.com/frontend/images/interface/avatars/-1.jpeg\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        6400,
        384
      ],
      "id": "4bf9e146-c8cb-432f-8b87-e792047cfcdd",
      "name": "Send Message6",
      "retryOnFail": false
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "be0f354c-24c0-4da1-9749-bcdb548b8f77",
              "name": "Message",
              "value": "✨ Gostou do material que te enviei até agora?  \nPara facilitar a sua visualização, segue o link com um 🏡 tour virtual da casa decorada!  \nVocê vai se sentir dentro do imóvel, vendo cada detalhe como se estivesse visitando pessoalmente!",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        6208,
        384
      ],
      "id": "4f5124ad-ca21-439e-b62c-037dd076694c",
      "name": "Edit Fields13"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "hPNyasIrRZAfBgY8",
          "mode": "list",
          "cachedResultUrl": "/workflow/hPNyasIrRZAfBgY8",
          "cachedResultName": "[Tool] - Enviar Midia"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "text_message": "=📚 Para complementar as informações sobre o empreendimento, o book é essencial!  \nPor isso, já aproveitei e te encaminhei com todos os detalhes 😉  ",
            "message_props": "={{ $('Webhook Media').item.json.body.message_props }}",
            "media_url": "={{ $('Get Empreendimento 2').item.json.pdf }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "media_url",
              "displayName": "media_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "text_message",
              "displayName": "text_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "message_props",
              "displayName": "message_props",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        7248,
        384
      ],
      "id": "1d8ef0ee-f8c9-456a-8e26-979d55607d25",
      "name": "Material - PDF1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5e4d9b61-6312-4d25-ae76-8c54c6a8432b",
              "name": "output",
              "value": "Agora mande a seguinte mensagem para o lead: \"Gostaria de Agendar uma visita ou já prefere fazer uma simulação?\"",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        7728,
        448
      ],
      "id": "5709ddbe-893c-46e9-ba11-7d471a81e30f",
      "name": "Edit Fields14"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "ventures",
          "mode": "list",
          "cachedResultName": "ventures"
        },
        "limit": 1,
        "where": {
          "values": [
            {
              "column": "name",
              "value": "={{    (     $('Get Lead5').item.json.custom_fields_values.find(item => item.field_id == 1025278)      || { values: [{ value: null }] }   ).values[0].value || '' }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        4592,
        464
      ],
      "id": "34d2e1af-3573-40d2-965b-bcf140bf9037",
      "name": "Get Empreendimento 2",
      "credentials": {
        "postgres": {
          "id": "M5tr6zjLSosI1qkl",
          "name": "Postgres FrontEnd"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "media",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        5056,
        368
      ],
      "id": "dca84d20-5a29-4098-8611-849f8efb7724",
      "name": "Split Out"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        5312,
        464
      ],
      "id": "ddab321d-ed8d-477f-8d5b-c925f76be178",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "99674ed1-9f77-446b-a3e1-ffef353d3f06",
              "leftValue": "={{ $('Get Empreendimento 2').item.json.link }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        5904,
        448
      ],
      "id": "80438793-1683-4009-b322-7251ad2203ab",
      "name": "Contem Link",
      "executeOnce": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://amojo.kommo.com/v2/{{ $('Webhook Media').item.json.body.message_props.chat_id }}/sendMessage",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "with_video",
              "value": "true"
            },
            {
              "name": "stand",
              "value": "v16"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Accept",
              "value": "application/json, text/javascript, */*; q=0.01"
            },
            {
              "name": "Accept-Language",
              "value": "pt-BR,pt;q=0.9,en-US;q=0.8,en;q=0.7,la;q=0.6"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Origin",
              "value": "=https://{{ $('Webhook Media').item.json.body.message_props.prefix }}.kommo.com "
            },
            {
              "name": "Referer",
              "value": "=https://{{ $('Webhook Media').item.json.body.message_props.prefix }}.kommo.com/"
            },
            {
              "name": "Sec-Fetch-Dest",
              "value": "empty"
            },
            {
              "name": "Sec-Fetch-Mode",
              "value": "cors"
            },
            {
              "name": "Sec-Fetch-Site",
              "value": "same-site"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36"
            },
            {
              "name": "X-Auth-Token",
              "value": "={{ $('Get Metadata3').item.json.acces_token }}"
            },
            {
              "name": "sec-ch-ua",
              "value": "\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\""
            },
            {
              "name": "sec-ch-ua-mobile",
              "value": "?0"
            },
            {
              "name": "sec-ch-ua-platform",
              "value": "\"Linux\""
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"recipient_id\": \"{{ $('Webhook Media').item.json.body.message_props.recipient_id }}\",\n  \"group_id\": null,\n  \"text\": \"{{ $('Get Empreendimento 2').item.json.link }}\",\n  \"crm_dialog_id\": {{ $('Webhook Media').item.json.body.message_props.crm_dialog_id }},\n  \"crm_contact_id\": {{ $('Webhook Media').item.json.body.message_props.crm_contact_id }},\n  \"crm_account_id\": {{ $('Webhook Media').item.json.body.message_props.crm_account_id }},\n  \"crm_entity\": {\n    \"id\": {{ $('Webhook Media').item.json.body.message_props.crm_entity.id }},\n    \"type\": 2\n  },\n  \"persona_name\": \"IA\",\n  \"persona_avatar\": \"https://images.kommo.com/frontend/images/interface/avatars/-1.jpeg\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        6576,
        384
      ],
      "id": "d5139202-2155-41a9-b38d-5f4bdac813b1",
      "name": "Send Link",
      "retryOnFail": false
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        6816,
        448
      ],
      "id": "18fa55ed-1ac1-4452-9103-1f996993aab5",
      "name": "Merge"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "99674ed1-9f77-446b-a3e1-ffef353d3f06",
              "leftValue": "={{ $('Get Empreendimento 2').item.json.pdf }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        7008,
        448
      ],
      "id": "e08cb95d-f1df-47b4-a6e3-cda67c5d641e",
      "name": "Contem PDF",
      "executeOnce": true
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        7504,
        448
      ],
      "id": "f4074793-607c-43f4-bf95-db9c9b9202b8",
      "name": "Merge1"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "8910e964-8830-4fdf-8cc6-2d9fc977c5bb-media",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        3728,
        464
      ],
      "id": "5299af7f-dc2e-456a-9017-4940bd94c1bb",
      "name": "Webhook Media",
      "webhookId": "8910e964-8830-4fdf-8cc6-2d9fc977c5bb",
      "credentials": {
        "httpBasicAuth": {
          "id": "JkIMD1dDp2CjIaFX",
          "name": "[Tools] - Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "content": "## Envia mídias\n",
        "height": 516,
        "width": 4336
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3632,
        256
      ],
      "typeVersion": 1,
      "id": "d14e2457-3484-459f-9c1b-fc725ab84169",
      "name": "Sticky Note empreendimento2",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a2b3c4d-aaaa-bbbb-cccc-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "4e5f6g7h-cccc-dddd-eeee-444455556666",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3952,
        1008
      ],
      "id": "b3a07694-3062-4162-a3b9-cd78c1ffb701",
      "name": "Edit Fields Img 5"
    },
    {
      "parameters": {
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "with",
              "value": "contacts,companies"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4400,
        1008
      ],
      "id": "ee44b49d-3718-46bf-b44f-0529216c6305",
      "name": "Get Lead6",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7c011ac5-a7dd-4c09-a840-f14b216bbc0e",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4848,
        1008
      ],
      "id": "a6958b63-10b8-47b9-b54d-5852cf6c7da4",
      "name": "If6"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "34459ceb-c139-4fb7-a50f-7d57df46e6b8",
              "name": "Output",
              "value": "Empreendimento Não encontrado ou não atrelado ao lead.\nchame novamente a ferramenta `preenche_empreendimento` para garantir que o empreendimento está preenchido e depois chame essa ferramenta novamente",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5072,
        1104
      ],
      "id": "396b4217-b78c-4912-b0c5-368b1d9efe9a",
      "name": "Edit Fields15"
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        4176,
        1008
      ],
      "id": "c5c3ccdb-b71e-44f1-9579-857650e5e9eb",
      "name": "Wait5",
      "webhookId": "1b03d023-5e73-4e67-8cb4-ca4ef3438ff1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5e4d9b61-6312-4d25-ae76-8c54c6a8432b",
              "name": "output",
              "value": "Continue o atendimento perguntando o estado civil",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5520,
        912
      ],
      "id": "c0dcf673-f0cf-4770-83ff-93b456689d99",
      "name": "Edit Fields16"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "ventures",
          "mode": "list",
          "cachedResultName": "ventures"
        },
        "limit": 1,
        "where": {
          "values": [
            {
              "column": "name",
              "value": "={{    (     $('Get Lead6').item.json.custom_fields_values.find(item => item.field_id == 1025278)      || { values: [{ value: null }] }   ).values[0].value || '' }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        4624,
        1008
      ],
      "id": "2ffa0adc-de00-4be9-b9dd-fa8c977ce5aa",
      "name": "Get Empreendimento 3",
      "credentials": {
        "postgres": {
          "id": "M5tr6zjLSosI1qkl",
          "name": "Postgres FrontEnd"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "hPNyasIrRZAfBgY8",
          "mode": "list",
          "cachedResultUrl": "/workflow/hPNyasIrRZAfBgY8",
          "cachedResultName": "[Tool] - Enviar Midia"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "text_message": "={{ $json.simulation_text }}",
            "message_props": "={{ $('Webhook Simulacao').item.json.body.message_props }}",
            "media_url": "={{ $json.simulation_media }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "media_url",
              "displayName": "media_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "text_message",
              "displayName": "text_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "message_props",
              "displayName": "message_props",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        5072,
        912
      ],
      "id": "dcc5f408-4486-4331-a121-5751aad69007",
      "name": "Simulacao"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "8910e964-8830-4fdf-8cc6-2d9fc977c5bb-media-simulacao",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        3728,
        1008
      ],
      "id": "b4ac5986-5bbb-407f-8f71-49bc143d574e",
      "name": "Webhook Simulacao",
      "webhookId": "8910e964-8830-4fdf-8cc6-2d9fc977c5bb",
      "credentials": {
        "httpBasicAuth": {
          "id": "JkIMD1dDp2CjIaFX",
          "name": "[Tools] - Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "content": "## Envia mídia - Simulação\n",
        "height": 516,
        "width": 2160
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3632,
        832
      ],
      "typeVersion": 1,
      "id": "a8becb23-7745-479c-acea-4c6771f01021",
      "name": "Sticky Note empreendimento3",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $('Edit Fields Img 5').item.json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "status_id",
              "value": "={{92937723}}"
            },
            {
              "name": "pipeline_id",
              "value": "={{ 10762739 }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5296,
        912
      ],
      "id": "93c3e953-ab42-4820-987f-fd5f3bbe2467",
      "name": "Mover simulacao1",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a2b3c4d-aaaa-bbbb-cccc-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "9f8e7d6c-5555-4444-3333-222211110000",
              "name": "motivo",
              "value": "={{ $json.body.motivo }}",
              "type": "string"
            },
            {
              "id": "4e5f6g7h-cccc-dddd-eeee-444455556666",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3040,
        2960
      ],
      "id": "234bae7f-7d24-457a-8f9b-f9ce94dd1a63",
      "name": "Edit Fields motivo"
    },
    {
      "parameters": {
        "content": "## Preenche motivo\n",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        2880
      ],
      "typeVersion": 1,
      "id": "3d8c5eb2-6f74-41cc-b8a8-a1363b3f36a4",
      "name": "Sticky Note motivo",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [\n    {\n      \"field_id\": 1062936,\n      \"values\": [\n        {\n          \"value\": \"{{ $json.motivo }}\"\n        }\n      ]\n    }\n  ]\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3296,
        2960
      ],
      "id": "f78b77bf-5096-4ceb-ac0f-f33afd1f530b",
      "name": "Update motivo",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "333376e9-fd98-46c4-a8e4-6be36738a6ef-motivo",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        2800,
        2960
      ],
      "id": "19a7eb44-c82f-420e-8a42-0a9783df7169",
      "name": "Webhook motivo",
      "webhookId": "333376e9-fd98-46c4-a8e4-6be36738a6ef",
      "credentials": {
        "httpBasicAuth": {
          "id": "JkIMD1dDp2CjIaFX",
          "name": "[Tools] - Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a2b3c4d-aaaa-bbbb-cccc-111122223333",
              "name": "response",
              "value": "ok",
              "type": "string"
            },
            {
              "id": "9f8e7d6c-5555-4444-3333-222211110000",
              "name": "data_visita",
              "value": "={{ $json.body.data_visita }}",
              "type": "string"
            },
            {
              "id": "4e5f6g7h-cccc-dddd-eeee-444455556666",
              "name": "lead_id",
              "value": "={{ $json.body.lead_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3040,
        3280
      ],
      "id": "2b4d97c7-de87-4658-b491-f4cf85b317db",
      "name": "Edit Fields data_visita"
    },
    {
      "parameters": {
        "content": "## Preenche data_visita\n",
        "height": 260,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        3200
      ],
      "typeVersion": 1,
      "id": "4217af28-c70c-47d0-bdc6-040cbc4825bc",
      "name": "Sticky Note data_visita",
      "disabled": true
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"custom_fields_values\": [\n    {\n      \"field_id\": 1061418,\n      \"values\": [\n        {\n          \"value\": {{ $json.data_visita.toDateTime().toSeconds() }}\n        }\n      ]\n    }\n  ],\n  \"status_id\": 92937719,\n  \"pipeline_id\": 10762739\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3296,
        3280
      ],
      "id": "ea2c1fc3-9af5-4789-a51e-8088448b0736",
      "name": "Update data_visita",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "333376e9-fd98-46c4-a8e4-6be36738a6ef-data_visita",
        "authentication": "basicAuth",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        2800,
        3280
      ],
      "id": "918514f4-b821-4d49-a59a-9c66faf94ed2",
      "name": "Webhook data_visita",
      "webhookId": "333376e9-fd98-46c4-a8e4-6be36738a6ef",
      "credentials": {
        "httpBasicAuth": {
          "id": "JkIMD1dDp2CjIaFX",
          "name": "[Tools] - Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "hPNyasIrRZAfBgY8",
          "mode": "list",
          "cachedResultUrl": "/workflow/hPNyasIrRZAfBgY8",
          "cachedResultName": "[Tool] - Enviar Midia"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "text_message": "=",
            "message_props": "={{ $('Webhook img 1').item.json.body.message_props }}",
            "media_url": "={{ $json.base64 }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "media_url",
              "displayName": "media_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "text_message",
              "displayName": "text_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "message_props",
              "displayName": "message_props",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        5264,
        -64
      ],
      "id": "23556fe8-0372-43de-a4a6-23d3a61392d1",
      "name": "Material - Media 6"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://joiceadv.kommo.com/api/v4/leads/{{ $('Edit Fields Img 5').item.json.lead_id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "status_id",
              "value": "={{92937723}}"
            },
            {
              "name": "pipeline_id",
              "value": "={{ 10762739 }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3552,
        3296
      ],
      "id": "5f663aab-80d7-46e4-8238-ac7e535de4a7",
      "name": "Mover simulacao2",
      "credentials": {
        "oAuth2Api": {
          "id": "YgpgTfTiRvkNqmYU",
          "name": "[Kommo] - OAuth2"
        }
      }
    }
  ],
  "pinData": {
    "Webhook Tipo Visto": [
      {
        "json": {
          "headers": {
            "host": "joiceadv.up.railway.app",
            "user-agent": "axios/1.8.3",
            "content-length": "58",
            "accept": "application/json",
            "accept-encoding": "gzip, compress, deflate, br",
            "authorization": "Basic ZWxhaW5lLWJyaXRvOm9QWWc2bkp6ZmZMdXJYRmJsclBqTnBrWU1tVXRyeEJr",
            "content-type": "application/json",
            "x-forwarded-for": "162.220.232.42",
            "x-forwarded-host": "joiceadv.up.railway.app",
            "x-forwarded-proto": "https",
            "x-railway-edge": "railway/us-west2",
            "x-railway-request-id": "IgRK-hp2SFmeVJIkn6XIxQ",
            "x-real-ip": "162.220.232.42",
            "x-request-start": "1755828383660"
          },
          "params": {},
          "query": {},
          "body": {
            "lead_id": 1604460,
            "tipo_visto": "e9_estudante_temporario"
          },
          "webhookUrl": "https://joiceadv.up.railway.app/webhook/777776e9-fd98-46c4-a8e4-6be36738a6e7",
          "executionMode": "production"
        }
      }
    ],
    "Webhook pessoas": [
      {
        "json": {
          "headers": {
            "host": "joiceadv.up.railway.app",
            "user-agent": "axios/1.8.3",
            "content-length": "34",
            "accept": "application/json",
            "accept-encoding": "gzip, compress, deflate, br",
            "authorization": "Basic dG9vbHNfdXNlcjpUSHFkZ3dMUThPaWszbWExcXI4MzdxWlRwdDRndEQwU3lLNktCU1JCdkh0NFA3QlNJUkVhSFd0N1dvTzY3bGw3",
            "content-type": "application/json",
            "x-forwarded-for": "162.220.232.13",
            "x-forwarded-host": "joiceadv.up.railway.app",
            "x-forwarded-proto": "https",
            "x-railway-edge": "railway/us-west2",
            "x-railway-request-id": "C242l-yWTvKZFyLxn6XIxQ",
            "x-real-ip": "162.220.232.13",
            "x-request-start": "1757643804415"
          },
          "params": {},
          "query": {},
          "body": {
            "lead_id": 13612718,
            "pessoas": "4"
          },
          "webhookUrl": "https://joiceadv.up.railway.app/webhook/333376e9-fd98-46c4-a8e4-6be36738a6ef-pessoas",
          "executionMode": "production"
        }
      }
    ],
    "Webhook idade_criacas": [
      {
        "json": {
          "headers": {
            "host": "joiceadv.up.railway.app",
            "user-agent": "axios/1.8.3",
            "content-length": "42",
            "accept": "application/json",
            "accept-encoding": "gzip, compress, deflate, br",
            "authorization": "Basic dG9vbHNfdXNlcjpUSHFkZ3dMUThPaWszbWExcXI4MzdxWlRwdDRndEQwU3lLNktCU1JCdkh0NFA3QlNJUkVhSFd0N1dvTzY3bGw3",
            "content-type": "application/json",
            "x-forwarded-for": "162.220.232.13",
            "x-forwarded-host": "joiceadv.up.railway.app",
            "x-forwarded-proto": "https",
            "x-railway-edge": "railway/us-west2",
            "x-railway-request-id": "kmtT9UVrS2WSCHxtn6XIxQ",
            "x-real-ip": "162.220.232.13",
            "x-request-start": "1757709240175"
          },
          "params": {},
          "query": {},
          "body": {
            "lead_id": 13612718,
            "idade_criacas": "1,2"
          },
          "webhookUrl": "https://joiceadv.up.railway.app/webhook/444476e9-fd98-46c4-a8e4-6be36738a6e4-idade_criacas",
          "executionMode": "production"
        }
      }
    ],
    "Webhook Media": [
      {
        "json": {
          "headers": {
            "host": "joiceadv.up.railway.app",
            "user-agent": "axios/1.12.0",
            "content-length": "322",
            "accept": "application/json",
            "accept-encoding": "gzip, compress, deflate, br",
            "authorization": "Basic YWktdG9vbHM6VXB0NEdQQ3AyVlZlV2d6",
            "content-type": "application/json",
            "x-forwarded-for": "162.220.232.136",
            "x-forwarded-host": "joiceadv.up.railway.app",
            "x-forwarded-proto": "https",
            "x-railway-edge": "railway/us-west2",
            "x-railway-request-id": "f_qaEA6OQDag3wPF0_TJvA",
            "x-real-ip": "162.220.232.136",
            "x-request-start": "1765091581429"
          },
          "params": {},
          "query": {},
          "body": {
            "lead_id": 18135878,
            "message_props": {
              "prefix": "joiceadv",
              "crm_entity": {
                "id": 18135878
              },
              "recipient_id": "31485898-c4ec-4380-bb45-058336ede156",
              "crm_dialog_id": 4137,
              "crm_contact_id": 22398914,
              "crm_account_id": 34332899,
              "text": "sim",
              "chat_id": "7cd90f4d-ac4c-410a-99fc-732d6165aab8",
              "lead_name": "Emerson",
              "contact_id": "22398914"
            }
          },
          "webhookUrl": "https://joiceadv.up.railway.app/webhook/8910e964-8830-4fdf-8cc6-2d9fc977c5bb-media",
          "executionMode": "production"
        }
      }
    ],
    "Webhook Simulacao": [
      {
        "json": {
          "headers": {
            "host": "joiceadv.up.railway.app",
            "user-agent": "axios/1.12.0",
            "content-length": "322",
            "accept": "application/json",
            "accept-encoding": "gzip, compress, deflate, br",
            "authorization": "Basic YWktdG9vbHM6VXB0NEdQQ3AyVlZlV2d6",
            "content-type": "application/json",
            "x-forwarded-for": "162.220.232.136",
            "x-forwarded-host": "joiceadv.up.railway.app",
            "x-forwarded-proto": "https",
            "x-railway-edge": "railway/us-west2",
            "x-railway-request-id": "16SBS8qQTH-w1ni_LPU1MQ",
            "x-real-ip": "162.220.232.136",
            "x-request-start": "1765092362861"
          },
          "params": {},
          "query": {},
          "body": {
            "lead_id": 18135878,
            "message_props": {
              "prefix": "joiceadv",
              "crm_entity": {
                "id": 18135878
              },
              "recipient_id": "31485898-c4ec-4380-bb45-058336ede156",
              "crm_dialog_id": 4137,
              "crm_contact_id": 22398914,
              "crm_account_id": 34332899,
              "text": "sim",
              "chat_id": "7cd90f4d-ac4c-410a-99fc-732d6165aab8",
              "lead_name": "Emerson",
              "contact_id": "22398914"
            }
          },
          "webhookUrl": "https://joiceadv.up.railway.app/webhook/8910e964-8830-4fdf-8cc6-2d9fc977c5bb-media-simulacao",
          "executionMode": "production"
        }
      }
    ],
    "Webhook img 1": [
      {
        "json": {
          "headers": {
            "host": "joiceadv.up.railway.app",
            "user-agent": "axios/1.12.0",
            "content-length": "320",
            "accept": "application/json",
            "accept-encoding": "gzip, compress, deflate, br",
            "authorization": "Basic YWktdG9vbHM6VXB0NEdQQ3AyVlZlV2d6",
            "content-type": "application/json",
            "x-forwarded-for": "162.220.232.136",
            "x-forwarded-host": "joiceadv.up.railway.app",
            "x-forwarded-proto": "https",
            "x-railway-edge": "railway/us-west2",
            "x-railway-request-id": "mTsvOyUfQfGbLeKinpoFkQ",
            "x-real-ip": "162.220.232.136",
            "x-request-start": "1765095217319"
          },
          "params": {},
          "query": {},
          "body": {
            "lead_id": 18135878,
            "message_props": {
              "prefix": "joiceadv",
              "crm_entity": {
                "id": 18135878
              },
              "recipient_id": "31485898-c4ec-4380-bb45-058336ede156",
              "crm_dialog_id": 4137,
              "crm_contact_id": 22398914,
              "crm_account_id": 34332899,
              "text": "4",
              "chat_id": "7cd90f4d-ac4c-410a-99fc-732d6165aab8",
              "lead_name": "Emerson",
              "contact_id": "22398914"
            }
          },
          "webhookUrl": "https://joiceadv.up.railway.app/webhook/333376e9-fd98-46c4-a8e4-6be36738a6ef-img-1",
          "executionMode": "production"
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "createdAt": "2025-10-24T05:55:00.949Z",
      "updatedAt": "2025-10-24T05:55:00.949Z",
      "role": "workflow:owner",
      "workflowId": "hzuEuhPpSI5wsGKH",
      "projectId": "CdOjQfB3kNlqg1ah"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 16,
  "updatedAt": "2025-12-07T08:49:07.898Z",
  "versionId": "e8ab3f6c-5104-42db-b256-1f971390aa2a"
}